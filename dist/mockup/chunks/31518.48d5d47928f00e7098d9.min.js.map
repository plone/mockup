{"version":3,"file":"chunks/31518.48d5d47928f00e7098d9.min.js","mappings":"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","sources":["webpack://@plone/mockup/./src/pat/controlpanels/schemaeditor--implementation.js"],"sourcesContent":["import $ from \"jquery\";\n\nexport default class SchemaEditor {\n    constructor(el) {\n        this.el = el;\n    }\n\n    init() {\n        if ($(\"#form fieldset\", this.el).length >= 2) {\n            // If multiple fieldsets, release after autotoc has been initialized\n            if ($(\"#form .autotoc-nav > a\", this.el).length) {\n                // pat-autotoc already initialized, script probably run after\n                // mockup initialization.\n                this.init_schemaeditor();\n            } else {\n                // Otherwise, wait until autotoc is ready.\n                $(window).on(\"init.autotoc.patterns\", this.init_schemaeditor);\n            }\n        } else {\n            // If only one fieldset, initialize immediately\n            this.init_schemaeditor();\n        }\n    }\n\n    init_add_field(fieldset_id) {\n        if (fieldset_id) {\n            var $add_field = $(\"a#add-field\", this.el);\n            var $fieldset = $(\"#form fieldset#fieldset-\" + fieldset_id, this.el);\n            if ($fieldset.data(\"can-add-fields\") === false) {\n                $add_field.addClass(\"disabled\");\n            } else {\n                var href = $add_field.attr(\"href\").split(\"?\")[0]; // get base href without any previously set ``fieldset_id``.\n                $add_field.attr(\"href\", href + \"?fieldset_id=\" + fieldset_id);\n                $add_field.removeClass(\"disabled\");\n            }\n        }\n    }\n\n    init_schemaeditor() {\n        // delete field\n        $(\"a.schemaeditor-delete-field\", this.el).on(\"click\", function (e) {\n            var trigger = $(this);\n            e.preventDefault();\n            if (!window.confirm(trigger.attr(\"data-confirm_msg\"))) {\n                return;\n            }\n            $.post(\n                trigger.attr(\"href\"),\n                {\n                    _authenticator: $('input[name=\"_authenticator\"]', this.el).val(),\n                },\n                // eslint-disable-next-line no-unused-vars\n                function (data) {\n                    trigger.closest(\".fieldPreview\").detach();\n                },\n                \"text\"\n            );\n        });\n\n        var set_id_from_title = function () {\n            var id = $.plone_schemaeditor_normalize_string($(this).val());\n            $(\"#form-widgets-__name__\", this.el).val(id);\n        };\n        // set id from title\n        $(\"body\").on(\n            \"focusout\",\n            \"#form-widgets-title, #form-widgets-label\",\n            set_id_from_title\n        );\n\n        // reorder fields and change fieldsets\n        // initialize after autotoc pattern is loaded.\n        $(\".fieldPreview.orderable\", this.el).plone_schemaeditor_html5_sortable(\n            function (position, fieldset_index) {\n                var url = [\n                    location.protocol,\n                    \"//\",\n                    location.host,\n                    location.pathname.replace(\"/@@fields\", \"\"),\n                    \"/\",\n                    this.attr(\"data-field_id\"),\n                    \"/@@order\",\n                ].join(\"\");\n                $.post(url, {\n                    _authenticator: $('input[name=\"_authenticator\"]', this.el).val(),\n                    pos: position,\n                    fieldset_index: fieldset_index,\n                });\n            },\n            function (fieldset_index) {\n                var url = [\n                    location.protocol,\n                    \"//\",\n                    location.host,\n                    location.pathname.replace(\"/@@fields\", \"\"),\n                    \"/\",\n                    this.attr(\"data-field_id\"),\n                    \"/@@changefieldset\",\n                ].join(\"\");\n                $.post(url, {\n                    _authenticator: $('input[name=\"_authenticator\"]', this.el).val(),\n                    fieldset_index: fieldset_index,\n                });\n            }\n        );\n\n        var self = this;\n        // ///////////////\n        // ADD FIELD INIT\n        $(\"#form .autotoc-nav > a\", this.el).each(function () {\n            $(this).on(\"click\", function (e) {\n                e.preventDefault();\n                var fieldset_id = $(this).attr(\"data-fieldset_drag_id\");\n                self.init_add_field(fieldset_id);\n            });\n        });\n\n        var fieldset_id = $(\"#form .autotoc-nav > a.active\", this.el).attr(\n            \"data-fieldset_drag_id\"\n        );\n        this.init_add_field(fieldset_id);\n    }\n}\n\n$.plone_schemaeditor_normalize_string = function (s) {\n    s = s.toLowerCase();\n    var rules = {\n        a: /[àáâãäå]/g,\n        ae: /[æ]/g,\n        c: /[ç]/g,\n        e: /[èéêë]/g,\n        i: /[ìíîï]/g,\n        n: /[ñ]/g,\n        o: /[òóôõö]/g,\n        oe: /[œ]/g,\n        u: /[ùúûü]/g,\n        y: /[ýÿ]/g,\n        th: /[ðþ]/g,\n        ss: /[ß]/g,\n        _: /[\\s\\\\]+/g,\n    };\n    for (var r in rules) s = s.replace(rules[r], r);\n    return s.replace(/[^a-z0-9_]/g, \"_\");\n};\n\n$.fn.plone_schemaeditor_html5_sortable = function (\n    reorder_callback,\n    changefieldset_callback\n) {\n    /* Takes two callbacks as arguments:\n     * reorder_callback : the callback when we move a field relatively to other fields\n     * changefieldset_callback : the callback when we move a field to a legend or a tab\n     */\n\n    // ///////////\n    // DRAGGABLES\n\n    this.attr(\"draggable\", \"true\")\n        .css(\"-webkit-user-drag\", \"element\")\n        .each(function (i) {\n            $(this).attr(\"data-drag_id\", i);\n\n            this.ondragstart = function (e) {\n                e.dataTransfer.setData(\"Text\", $(this).attr(\"data-drag_id\"));\n                e.dataTransfer.setData(\"draggable\", true);\n                $(\n                    '<div id=\"drop-marker\" style=\"position: absolute; width: 100%;\"></div>'\n                ).insertBefore(this);\n            };\n            // eslint-disable-next-line no-unused-vars\n            this.ondragenter = function (e) {\n                return false;\n            };\n            // eslint-disable-next-line no-unused-vars\n            this.ondragleave = function (e) {\n                return false;\n            };\n            this.ondragover = function (e) {\n                var position = $(this).position(),\n                    height = $(this).height(),\n                    marker = $(\"#drop-marker\");\n                marker.css(\"border-bottom\", \"5px dotted red\");\n                if (e.pageY < $(this).offset().top + height / 2) {\n                    marker.css(\"top\", position.top + 1 + \"px\");\n                    $(this).attr(\"draghalf\", \"top\");\n                } else {\n                    marker.css(\"top\", position.top + height + 21 + \"px\");\n                    $(this).attr(\"draghalf\", \"bottom\");\n                }\n                // window autoscroll\n                if (!$(\"html,body\").is(\":animated\")) {\n                    if ($(window).scrollTop() + $(window).height() - e.pageY < 30) {\n                        // bottom\n                        $(\"html,body\").animate(\n                            { scrollTop: $(window).scrollTop() + 50 },\n                            200\n                        );\n                    } else if (e.pageY - $(window).scrollTop() < 30) {\n                        // top\n                        $(\"html,body\").animate(\n                            { scrollTop: $(window).scrollTop() - 50 },\n                            200\n                        );\n                    }\n                }\n                return false;\n            };\n            this.ondrop = function (e) {\n                /* We move the field, into the same fieldset (simple reorder into the fieldset)\n                 * or into an other fieldset (we set a new position in a new fieldset)\n                 */\n                e.preventDefault();\n                var src = e.dataTransfer.getData(\"Text\"),\n                    node = $(\"[data-drag_id=\" + src + \"]\");\n                if ($(this).attr(\"data-drag_id\") === src) {\n                    return;\n                }\n                if ($(this).attr(\"draghalf\") === \"top\") {\n                    node.insertBefore(this);\n                } else {\n                    node.insertAfter(this);\n                }\n                var target_fieldset_id = $(this)\n                    .parents(\"fieldset\")\n                    .first()\n                    .find(\"legend\")\n                    .attr(\"data-fieldset_drag_id\");\n                // position is the new position of the field, in the same fielsdet or in the new fieldset\n                var position = node.parent().children(\"[data-drag_id]\").index(node);\n                reorder_callback.apply(node, [position, target_fieldset_id]);\n            };\n            // eslint-disable-next-line no-unused-vars\n            this.ondragend = function (e) {\n                $(\"#drop-marker\").remove();\n            };\n        });\n\n    // ///////////\n    // DROPPABLES\n\n    var self = this;\n    // Make tab and legend elements droppable. we drop on legend when form tabbing is disabled\n    $(\"#form fieldset legend\").each(function (i) {\n        var $fieldset = $(\"#form fieldset#fieldset-\" + i, self.el);\n        if ($fieldset.data(\"can-add-fields\") === true) {\n            $(this).attr(\"droppable\", \"true\");\n        }\n        $(this).attr(\"data-fieldset_drag_id\", i);\n    });\n    $(\"#form .autotoc-nav > a\").each(function (i) {\n        // Plone 5 / mockup\n        var $fieldset = $(\"#form fieldset#fieldset-\" + i, self.el);\n        if ($fieldset.data(\"can-add-fields\") === true) {\n            $(this).attr(\"droppable\", \"true\");\n            this.ondrop = function (e) {\n                // apply change fieldset when we drop a field on a tab or a legend\n                e.preventDefault();\n                var src = e.dataTransfer.getData(\"Text\"),\n                    node = $(\"[data-drag_id=\" + src + \"]\");\n                var orig_fieldset = node.parents(\"fieldset\");\n                var orig_fieldset_id = orig_fieldset.attr(\"id\").split(\"-\")[1];\n                var target_fieldset_id = $(this).attr(\"data-fieldset_drag_id\");\n                if (orig_fieldset_id != target_fieldset_id) {\n                    var target_fieldset = $(\"#fieldset-\" + target_fieldset_id),\n                        tab_position = $(this).position();\n                    node.animate(\n                        {\n                            top: tab_position.top - node.position().top,\n                            left: tab_position.left - node.position().left,\n                            width: \"50%\",\n                            opacity: \"0\",\n                        },\n                        1000,\n                        function () {\n                            node.appendTo(target_fieldset);\n                            node.css(\"left\", \"\");\n                            node.css(\"top\", \"\");\n                            node.css(\"width\", \"\");\n                            node.css(\"opacity\", \"\");\n                        }\n                    );\n                    changefieldset_callback.apply(node, [target_fieldset_id]);\n                }\n                $(this).css(\"border\", \"\");\n            };\n            this.ondragover = function (e) {\n                // style when we drag over tab or legend\n                e.preventDefault();\n                var draggable = e.dataTransfer.getData(\"draggable\");\n                if (draggable) {\n                    $(this).css(\"border\", \"3px dotted red\");\n                    $(\"#drop-marker\").hide();\n                }\n                return false;\n            };\n            this.ondragleave = function (e) {\n                // remove style when we leave tab or legend\n                e.preventDefault();\n                $(this).css(\"border\", \"\");\n                $(\"#drop-marker\").show();\n            };\n        }\n        $(this).attr(\"data-fieldset_drag_id\", i);\n    });\n\n    $('<span class=\"draghandle\">&#x28FF;</span>')\n        .css(\"cursor\", \"ns-resize\")\n        .prependTo(\".fieldPreview.orderable .fieldLabel\");\n};\n"],"names":["SchemaEditor","constructor","el","this","init","$","length","init_schemaeditor","window","on","init_add_field","fieldset_id","$add_field","data","addClass","href","attr","split","removeClass","e","trigger","preventDefault","confirm","_authenticator","val","closest","detach","id","plone_schemaeditor_html5_sortable","position","fieldset_index","url","location","protocol","host","pathname","replace","join","pos","self","each","s","toLowerCase","rules","a","ae","c","i","n","o","oe","u","y","th","ss","_","r","reorder_callback","changefieldset_callback","css","ondragstart","dataTransfer","setData","insertBefore","ondragenter","ondragleave","ondragover","height","marker","pageY","offset","top","is","scrollTop","animate","ondrop","src","getData","node","insertAfter","target_fieldset_id","parents","first","find","parent","children","index","apply","ondragend","remove","orig_fieldset_id","target_fieldset","tab_position","left","width","opacity","appendTo","hide","show","prependTo"],"sourceRoot":""}