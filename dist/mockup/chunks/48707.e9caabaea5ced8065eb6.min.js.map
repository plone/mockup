{"version":3,"file":"chunks/48707.e9caabaea5ced8065eb6.min.js","mappings":"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","sources":["webpack://@plone/mockup/./src/pat/controlpanels/discussion-comments--implementation.js"],"sourcesContent":["import $ from \"jquery\";\n\nexport default class Contentrules {\n    constructor(el) {\n        this.el = el;\n    }\n    /**************************************************************************\n     * Create a reply-to-comment form right beneath the form that is passed to\n     * the function. We do this by copying the regular comment form and\n     * adding a hidden in_reply_to field to the form.\n     **************************************************************************/\n    createReplyForm(comment_div) {\n        var comment_id = comment_div.attr(\"id\");\n\n        var reply_button = comment_div.find(\".reply-to-comment-button\");\n\n        /* Clone the reply div at the end of the page template that contains\n         * the regular comment form.\n         */\n        var reply_div = $(\"#commenting\").clone(true);\n\n        /* Remove the ReCaptcha JS code before appending the form. If not\n         * removed, this causes problems\n         */\n        reply_div.find(\"#formfield-form-widgets-captcha\").find(\"script\").remove();\n\n        /* Insert the cloned comment form right after the reply button of the\n         * current comment.\n         */\n        reply_div.appendTo(comment_div).css(\"display\", \"none\");\n\n        /* Remove id='commenting' attribute, since we use it to uniquely define\n            the main reply form. */\n        // Still belongs to class='reply'\n        reply_div.removeAttr(\"id\");\n\n        /* Hide the reply button (only hide, because we may want to show it\n         * again if the user hits the cancel button).\n         */\n        $(reply_button).css(\"display\", \"none\");\n\n        /* Fetch the reply form inside the reply div */\n        var reply_form = reply_div.find(\"form\");\n\n        /* Change the id of the textarea of the reply form\n         * To avoid conflict later between textareas with same id 'form-widgets-comment-text' while implementing a seperate instance of TinyMCE\n         * */\n        reply_form\n            .find(\"#formfield-form-widgets-comment-text\")\n            .attr(\"id\", \"formfield-form-widgets-new-textarea\" + comment_id);\n        reply_form\n            .find(\"#form-widgets-comment-text\")\n            .attr(\"id\", \"form-widgets-new-textarea\" + comment_id);\n\n        /* Populate the hidden 'in_reply_to' field with the correct comment\n            id */\n        reply_form.find('input[name=\"form.widgets.in_reply_to\"]').val(comment_id);\n\n        /* Add a remove-reply-to-comment Javascript function to remove the\n            form */\n        var cancel_reply_button = reply_div.find(\".cancelreplytocomment\");\n        cancel_reply_button.attr(\"id\", comment_id);\n\n        /* Show the cancel buttons. */\n        reply_form.find('input[name=\"form.buttons.cancel\"]').css(\"display\", \"inline\");\n\n        /* Show the reply layer with a slide down effect */\n        reply_div.slideDown(\"slow\");\n\n        /* Show the cancel button in the reply-to-comment form */\n        cancel_reply_button.css(\"display\", \"inline\");\n    }\n\n    /**************************************************************************\n     * Remove all error messages and field values from the form that is passed\n     * to the function.\n     **************************************************************************/\n    clearForm(form_div) {\n        form_div.find(\".error\").removeClass(\"error\");\n        form_div.find(\".fieldErrorBox\").remove();\n        form_div.find('input[type=\"text\"]').attr(\"value\", \"\");\n        form_div.find(\"textarea\").attr(\"value\", \"\");\n        /* XXX: Clean all additional form extender fields. */\n    }\n\n    init_comment_eventhandler() {\n        /**********************************************************************\n         * Transmit a single comment.\n         **********************************************************************/\n        $('input[name=\"form.button.TransmitComment\"]').on(\"click\", (e) => {\n            e.preventDefault();\n            const trigger = e.currentTarget;\n            const $trigger = $(trigger);\n            const form = $trigger.parents(\"form\");\n            const $form = $(form);\n            const data = $form.serialize();\n            const form_url = $form.attr(\"action\");\n            const comment_id = $trigger.parents(\".comment\").attr(\"id\");\n            $.ajax({\n                type: \"GET\",\n                url: form_url,\n                data: data,\n                context: trigger,\n                success: () => {\n                    let url = location.href;\n                    $trigger.parents(\".comment\").load(\n                        // loading child nodes is not enough,\n                        // class attributes are needed for visualization of workflow_state\n                        `${url} #${comment_id}.comment`,\n                        () => {\n                            $trigger.find(\".comment\").unwrap();\n                            this.init_comment_eventhandler();\n                            $(\".pat-plone-modal\").patPloneModal();\n                        }\n                    );\n                },\n                error: () => true,\n            });\n            return false;\n        });\n\n        /**********************************************************************\n         * Edit a comment\n         **********************************************************************/\n        if ($.fn.prepOverlay) {\n            $('form[name=\"edit\"]').prepOverlay({\n                cssclass: \"overlay-edit-comment\",\n                width: \"60%\",\n                subtype: \"ajax\",\n                filter: \"#content>*\",\n            });\n        }\n\n        /**********************************************************************\n         * Delete a comment and its answers.\n         **********************************************************************/\n        $('input[name=\"form.button.DeleteComment\"]').on(\"click\", function (e) {\n            e.preventDefault();\n            var trigger = this;\n            var form = $(this).parents(\"form\");\n            var data = $(form).serialize();\n            var form_url = $(form).attr(\"action\");\n            $.ajax({\n                type: \"POST\",\n                url: form_url,\n                data: data,\n                context: $(trigger).parents(\".comment\"),\n                success: function () {\n                    var comment = $(this);\n                    var clss = comment.attr(\"class\");\n                    // remove replies\n                    var treelevel = parseInt(\n                        clss[clss.indexOf(\"replyTreeLevel\") + \"replyTreeLevel\".length],\n                        10\n                    );\n                    // selector for all the following elements of lower level\n                    var selector = \".replyTreeLevel\" + treelevel;\n                    for (var i = 0; i < treelevel; i++) {\n                        selector += \", .replyTreeLevel\" + i;\n                    }\n                    comment.nextUntil(selector).each(function () {\n                        $(this).fadeOut(\"fast\", function () {\n                            $(this).remove();\n                        });\n                    });\n                    // Add delete button to the parent\n                    var parent = comment.prev(\n                        '[class*=\"replyTreeLevel' + (treelevel - 1) + '\"]'\n                    );\n                    parent.find('form[name=\"delete\"]').css(\"display\", \"inline\");\n                    // remove comment\n                    $(this).fadeOut(\"fast\", function () {\n                        $(this).remove();\n                    });\n                },\n                error: function () {\n                    return true;\n                },\n            });\n            return false;\n        });\n    }\n\n    init() {\n        let self = this;\n        self.init_comment_eventhandler();\n\n        /**********************************************************************\n         * If the user has hit the reply button of a reply-to-comment form\n         * (form was submitted with a value for the 'in_reply_to' field in the\n         * request), create a reply-to-comment form right under this comment.\n         **********************************************************************/\n        var post_comment_div = $(\"#commenting\");\n        var in_reply_to_field = post_comment_div.find(\n            'input[name=\"form.widgets.in_reply_to\"]'\n        );\n        if (in_reply_to_field.length !== 0 && in_reply_to_field.val() !== \"\") {\n            var current_reply_id = \"#\" + in_reply_to_field.val();\n            var current_reply_to_div = $(\".discussion\").find(current_reply_id);\n            self.createReplyForm(current_reply_to_div);\n            self.clearForm(post_comment_div);\n        }\n\n        /**********************************************************************\n         * If the user hits the 'reply' button of an existing comment, create a\n         * reply form right beneath this comment.\n         **********************************************************************/\n        $(\".reply-to-comment-button\").on(\"click\", function () {\n            var comment_div = $(this).parents().filter(\".comment\");\n            self.createReplyForm(comment_div);\n            self.clearForm(comment_div);\n        });\n\n        /**********************************************************************\n         * If the user hits the 'clear' button of an open reply-to-comment form,\n         * remove the form and show the 'reply' button again.\n         **********************************************************************/\n        $(\"#commenting #form-buttons-cancel\").on(\"click\", function (e) {\n            e.preventDefault();\n            var reply_to_comment_button = $(this)\n                .parents()\n                .filter(\".comment\")\n                .find(\".reply-to-comment-button\");\n\n            /* Find the reply-to-comment form and hide and remove it again. */\n            self.reply_to_comment_form = $(this).parents().filter(\".reply\");\n            self.reply_to_comment_form.slideUp(\"slow\", function () {\n                $(this).remove();\n            });\n\n            /* Show the reply-to-comment button again. */\n            reply_to_comment_button.css(\"display\", \"inline\");\n        });\n\n        /**********************************************************************\n         * By default, hide the reply and the cancel button for the regular add\n         * comment form.\n         **********************************************************************/\n        $(\".reply\").find('input[name=\"form.buttons.reply\"]').css(\"display\", \"none\");\n        $(\".reply\").find('input[name=\"form.buttons.cancel\"]').css(\"display\", \"none\");\n\n        /**********************************************************************\n         * By default, show the reply button only when Javascript is enabled.\n         * Otherwise hide it, since the reply functions only work with JS\n         * enabled.\n         **********************************************************************/\n        $(\".reply-to-comment-button\").removeClass(\"hide\");\n    }\n}\n"],"names":["Contentrules","constructor","el","this","createReplyForm","comment_div","comment_id","attr","reply_button","find","reply_div","$","clone","remove","appendTo","css","removeAttr","reply_form","val","cancel_reply_button","slideDown","clearForm","form_div","removeClass","init_comment_eventhandler","on","e","preventDefault","trigger","currentTarget","$trigger","form","parents","$form","data","serialize","form_url","type","url","context","success","location","href","load","unwrap","patPloneModal","error","prepOverlay","cssclass","width","subtype","filter","comment","clss","treelevel","parseInt","indexOf","selector","i","nextUntil","each","fadeOut","prev","init","self","post_comment_div","in_reply_to_field","length","current_reply_id","current_reply_to_div","reply_to_comment_button","reply_to_comment_form","slideUp"],"sourceRoot":""}