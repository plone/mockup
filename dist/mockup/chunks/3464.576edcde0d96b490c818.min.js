"use strict";(self.webpackChunk_plone_mockup=self.webpackChunk_plone_mockup||[]).push([[3464],{3464:function(t,e,i){i.r(e),i.d(e,{default:function(){return W}});var s=i(35686),n=i.n(s),o=i(40705),a=i.n(o),l=i(61751),r=i(62800),c=i(49264),p=i(23505),h=i(73462),d=i.n(h),u=i(95722),f=i.n(u),g=f().View.extend({isUIView:!0,eventPrefix:"ui",template:null,idPrefix:"base-",appendInContainer:!0,initialize:function(t){for(var e in this.options=t,this.options)this[e]=this.options[e];this.options._t=l.Ay},render:function(){return this.applyTemplate(),this.trigger("render",this),this.afterRender(),this.options.id&&this.$el.attr("id",this.idPrefix+this.options.id),this},afterRender:function(){},serializedModel:function(){return this.options},applyTemplate:function(){if(null!==this.template){var t=n().extend({_t:l.Ay},this.options,this.serializedModel()),e=this.template;"string"==typeof e&&(e=a().template(e)),this.$el.html(e(t))}},propagateEvent:function(t){if(t.indexOf(":")>0){var e=t.split(":")[0];if(""!==this.eventPrefix&&(e===this.eventPrefix||e===this.eventPrefix+"."+this.id))return!0}return!1},uiEventTrigger:function(t){var e=[].slice.call(arguments,0);""!==this.eventPrefix&&(e[0]=this.eventPrefix+":"+t,f().View.prototype.trigger.apply(this,e),this.id&&(e[0]=this.eventPrefix+"."+this.id+":"+t,f().View.prototype.trigger.apply(this,e)))}}),m=g.extend({id:"",items:[],itemContainer:null,isOffsetParent:!0,idPrefix:"container-",render:function(){return this.options.id&&this.$el.attr("id",this.idPrefix+this.options.id),this.applyTemplate(),this.renderItems(),this.bindEvents(),this.isOffsetParent&&this.$el.addClass("ui-offset-parent"),this.trigger("render",this),this.afterRender(),this.$el.data("component",this),this},renderItems:function(){var t;if(null!==this.itemContainer){if(0===(t=n()(this.itemContainer,this.$el)).length)throw"Item Container element not found."}else t=this.$el;a().each(this.items,function(e){!0===e.appendInContainer?t.append(e.render().$el):e.render()},this)},bindEvents:function(){var t=this;a().each(this.items,function(e){e.on("all",function(){var e,i=[].slice,s=arguments[0],n=""!==t.id?t.id+"."+s:s;if(arguments.length>1&&(e=arguments[1]),n!==s){var o=i.call(arguments,0);o[0]=n,t.trigger.apply(t,o)}void 0!==e&&!0===e.isUIView&&!0===e.propagateEvent(s)&&t.trigger.apply(t,arguments)})})},get:function(t){return a().findWhere(this.items,{id:t})},add:function(t){if(void 0!==t.id&&this.get(t.id))throw"Another item with the same `id` already exists.";this.items.push(t)}}),b=m.extend({tagName:"div",className:"navbar",idPrefix:"toolbar-"}),v=m.extend({tagName:"div",className:"btn-group",idPrefix:"btngroup-",disable:function(){a().each(this.items,function(t){t.disable()})},enable:function(){a().each(this.items,function(t){t.enable()})}}),y=i(94232),w=g.extend({tagName:"a",className:"btn",eventPrefix:"button",context:"outline-secondary",idPrefix:"btn-",attributes:{href:"#"},extraClasses:[],tooltip:null,template:"<%= title %>",events:{click:"handleClick"},initialize:function(t){if(!t.id){const e=t.title||"";t.id=""!==e?e.toLowerCase().replace(" ","-"):this.cid}g.prototype.initialize.apply(this,[t]),this.on("render",async function(){if(this.$el.attr("title",this.options.title||""),this.$el.attr("aria-label",this.options.title||this.options.tooltip||""),null!==this.context&&this.$el.addClass("btn-"+this.context),a().each(this.extraClasses,function(t){this.$el.addClass(t)}.bind(this)),this.icon&&"string"==typeof this.icon){const t=await c.A.resolveIcon(this.icon),e=r.A.create_from_string(t);e&&this.$el.prepend(e)}null!==this.tooltip&&(this.$el.attr("title",this.tooltip),new y.Ay(this.$el),this.$el.on("hidden",function(t){"hidden"===t.type&&t.stopPropagation()}))},this)},handleClick:function(t){t.preventDefault(),this.$el.is(".disabled")||this.uiEventTrigger("click",this,t)},serializedModel:function(){return a().extend({icon:"",title:""},this.options)},disable:function(){this.$el.addClass("disabled")},enable:function(){this.$el.removeClass("disabled")}}),C=i(44563),x=i(59329);i(93052);const k={openItem:{url:"#",title:(0,l.Ay)("Open"),category:"button",icon:"plone-view",css:"",modal:!1},editItem:{url:"#",title:(0,l.Ay)("Edit"),category:"button",icon:"plone-edit",css:"",modal:!1},cutItem:{method:"cutClicked",url:"#",title:(0,l.Ay)("Cut"),category:"dropdown",icon:"plone-cut",css:"",modal:!1},copyItem:{method:"copyClicked",url:"#",title:(0,l.Ay)("Copy"),category:"dropdown",icon:"plone-copy",css:"",modal:!1},pasteItem:{method:"pasteClicked",url:"#",title:(0,l.Ay)("Paste"),category:"dropdown",icon:"plone-paste",css:"",modal:!1},"move-top":{method:"moveTopClicked",url:"#",title:(0,l.Ay)("Move to top of folder"),category:"dropdown",icon:"arrow-bar-up",css:"",modal:!1},"move-bottom":{method:"moveBottomClicked",url:"#",title:(0,l.Ay)("Move to bottom of folder"),category:"dropdown",icon:"arrow-bar-down",css:"",modal:!1},"set-default-page":{method:"setDefaultPageClicked",url:"#",title:(0,l.Ay)("Set as default page"),category:"dropdown",icon:"check-circle",css:"",modal:!1}};var _=function(t){if(null!==t.app.menuOptions)return t.app.menuOptions;const e=t.model.attributes,i=t.app,s=!!i.options.moveUrl,n=JSON.parse(JSON.stringify(k));i.pasteAllowed()&&e.is_folderish||delete n.pasteItem,(i.inQueryMode()||!1===s)&&(delete n["move-top"],delete n["move-bottom"]),-1!==i.defaultPageTypes.indexOf(e.portal_type)&&i.setDefaultPageUrl||delete n["set-default-page"];const o=i.options.typeToViewAction,a=o&&o[e.portal_type]||"";return n.openItem.url=e.getURL+a,n.editItem.url=e.getURL+"/edit",n},S=f().Model.extend({defaults:function(){return{is_folderish:!1,review_state:"",getURL:""}},uid:function(){return this.attributes.UID}}),P=f().Model.extend({initialize:function(t){this.options=t,this.app=t.app,this.model=t.model,this.selectedCollection=this.app.selectedCollection},selectAll:async function(t){t.preventDefault();let e=1,i=0;const s=async()=>{this.app.loading.show();const t=new URL(this.app.collection.url);t.searchParams.append("query",this.app.collection.queryParser({searchPath:this.model.attributes.path})),t.searchParams.append("batch",JSON.stringify({page:e,size:100})),t.searchParams.append("attributes",JSON.stringify(this.app.collection.queryHelper.options.attributes));const n=await fetch(t,{headers:{Accept:"application/json"}}),o=await n.json(),a=this.app.collection.parse(o,i);i+=a.length;for(const t of a)this.app.selectedCollection.add(new S(t));e+=1,o.total>i?await s():(this.app.loading.hide(),await this.app.tableView.render())};await s()},doAction:async function(t,e,i){const s=new URL(this.app.buttons.get(t).options.url),n=await fetch(s,{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",body:new URLSearchParams({selection:JSON.stringify([this.model.attributes.UID]),folder:this.model.attributes.path,_authenticator:c.A.getAuthenticator()})}),o=await n.json();let a,r="warning";"success"===o.status?(a=(0,l.Ay)(`${e} "${this.model.attributes.Title}"`),this.app.collection.fetch(),this.app.updateButtons()):(a=(0,l.Ay)("Error")+`: ${i} "${this.model.attributes.Title}"`,r="danger"),this.app.clearStatus(),this.app.setStatus({text:a,type:o.status||r})},cutClicked:function(t){t.preventDefault(),this.doAction("cut",(0,l.Ay)("Cut"),(0,l.Ay)("cutting"))},copyClicked:function(t){t.preventDefault(),this.doAction("copy",(0,l.Ay)("Copied"),(0,l.Ay)("copying"))},pasteClicked:function(t){t.preventDefault(),this.doAction("paste",(0,l.Ay)("Pasted into"),(0,l.Ay)("Error pasting into"))},moveTopClicked:function(t){t.preventDefault(),this.app.moveItem(this.model.attributes.id,"top")},moveBottomClicked:function(t){t.preventDefault(),this.app.moveItem(this.model.attributes.id,"bottom")},setDefaultPageClicked:async function(t){t.preventDefault();try{const t=new URL(this.app.getAjaxUrl(this.app.setDefaultPageUrl)),e=await fetch(t,{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",body:new URLSearchParams({id:this.model.attributes.id,_authenticator:c.A.getAuthenticator()})}),i=await e.json();this.app.ajaxSuccessResponse.apply(this.app,[i])}catch(t){this.app.ajaxSuccessResponse.apply(this.app,[t])}}}),$=g.extend({className:"btn-group actionmenu",template:a().template('<% _.each(menuOptions.button, (menuOption) => { %>\n<a class="btn btn-sm action pat-tooltip <%- menuOption.classes.join(\' \') %>"\n    href="<%- menuOption.url %>"\n    title="<%- _t(menuOption.title) %>"\n    aria-label="<%- _t(menuOption.title) %>">\n  <% if (menuOption.iconSVG) { %>\n    <%= menuOption.iconSVG %>\n  <% } else { %>\n  <%- _t(menuOption.title) %>\n  <% } %>\n</a>\n<% }); %>\n\n\n<% if (menuOptions.dropdown) { %>\n<div class="dropdown">\n  <button class="dropdown-toggle btn btn-sm"\n      type="button"\n      data-bs-toggle="dropdown"\n      aria-haspopup="true"\n      aria-expanded="false"\n      id="<%- id %>"\n      title=\'<%- _t("Actions") %>\'>\n    <%= dropdownIcon %><span class="caret"></span>\n  </button>\n  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="<%- id %>">\n    <% if (header) { %>\n      <li class="dropdown-header"><%- header %></li>\n      <li class="divider"></li>\n    <% } %>\n\n    <% _.each(menuOptions.dropdown, (menuOption) => { %>\n    <li>\n      <a class="dropdown-item action <%- menuOption.classes.join(\' \') %>"\n          href="<%- menuOption.url %>">\n        <% if (menuOption.iconSVG) { %>\n          <%= menuOption.iconSVG %>\n        <% } %>\n        <%- _t(menuOption.title) %>\n      </a>\n    </li>\n    <% }); %>\n  </ul>\n</div>\n<% } %>\n'),menuOptions:null,generate_events:function(){const t={};return a().each(this.menuOptions,(e,i)=>{const s=e.method;if(!s||!this.actions[s])return!1;t[`click a.${i}`]=this.actions[s].bind(this.actions)}),t},initialize:function(t){this.actions=new P(t),g.prototype.initialize.apply(this,[t]),this.options=t,this.selectedCollection=this.app.selectedCollection,this.menuOptions=_(this),this.events=this.generate_events(),this.delegateEvents()},menuOptionsCategorized:async function(){const t={};return a().each(this.menuOptions,async(e,i)=>{e.idx=c.A.generateId(),e.name=i;const s=e.category||"dropdown";void 0===t[s]&&(t[s]=[]),t[s].push(e),e.classes=[e.name,e.idx],e.css&&e.classes.push(e.css),!0===e.modal&&(e.css+=" pat-plone-modal"),e.icon&&(e.iconSVG=await c.A.resolveIcon(e.icon))}),t},render:async function(){this.el.innerHTML="";const t=this.model.toJSON();return t.header=this.options.header||null,t.menuOptions=await this.menuOptionsCategorized(),this.el.innerHTML=this.template(n().extend({dropdownIcon:await c.A.resolveIcon("plone-settings"),_t:l.Ay,id:c.A.generateId()},t)),this.options.className&&this.$el.addClass(this.options.className),x.A.scan(this.$el),this.el}}),A=f().View.extend({tagName:"tr",className:"itemRow",template:a().template('<td class="selection" data-order="<%- attributes[\'_sort\'] %>"><label for="select<%- attributes[\'_sort\'] %>InputCheckbox" class="hiddenStructure" aria-label="<%- _t(\'Select\') %>"><%- _t(\'Select\') %></label><input class="form-check-input" id="select<%- attributes[\'_sort\'] %>InputCheckbox" <% if(selected){ %> checked="checked" <% } %> type="checkbox"/></td>\n\n<td class="title">\n  <div>\n    <div>\n      <a href="<%- viewURL %>"\n          class="manage state-<%- review_state %> contenttype-<%- contenttype %>"\n          title="<%- portal_type %>">\n        <%= mimeIcon %>\n        <% if(Title){ %>\n          <%- Title %>\n        <% } else { %>\n          <em><%- id %></em>\n        <% } %>\n      </a>\n      <% if(exclude_from_nav){ %>\n        <span class="badge text-bg-secondary plone-item-exclude-from-nav"><%- _t(\'Excluded from navigation\') %></span>\n      <% } %>\n      <% if(expired){ %>\n        <span class="badge text-bg-danger plone-item-expired"><%- _t(\'Expired\') %></span>\n      <% } %>\n      <% if(ineffective){ %>\n        <span class="badge text-bg-warning plone-item-ineffective"><%- _t(\'Before publishing date\') %></span>\n      <% } %>\n      <% if(activeColumns.indexOf(\'Description\') !== -1 && _.has(availableColumns, \'Description\') && Description) { %>\n      <p class="Description">\n        <small>\n          <%- Description %>\n        </small>\n      </p>\n      <% } %>\n    </div>\n    <% if(attributes["getIcon"] && thumb_scale) { %>\n      <div class="lead-img">\n        <img class="thumb-<%- thumb_scale %>" alt="<%- _t(\'Preview image\') %> <%- Title || id %>" src="<%- getURL %>/@@images/image/<%- thumb_scale %>">\n      </div>\n    <% } %>\n  </div>\n</td>\n\n<% _.each(activeColumns, (column) => { %>\n  <% if(column !== \'Description\' && _.has(availableColumns, column)) { %>\n    <td class="<%- column %>" <% if (column === \'review_state\') { %>style="color: var(--plone-state-<%-attributes[column]%>)"<% } %> data-order="<%- attributes[column] %>"><%- convertColumnValue(column, attributes[column]) %></td>\n  <% } %>\n<% }); %>\n\n<td class="actionmenu-container"></td>\n'),events:{"change input":"itemSelected","click td.title a.manage":"itemClicked"},initialize:function(t){this.options=t,this.app=t.app,this.selectedCollection=this.app.selectedCollection,this.table=this.options.table,this.now=new Date,this.listenTo(this.table,"context-info:set",this.render)},expired:function(t){if(!t.attributes.ExpirationDate)return!1;const e=new Date(t.attributes.ExpirationDate);return this.now>e},ineffective:function(t){if(!t.attributes.EffectiveDate)return!1;const e=new Date(t.attributes.EffectiveDate);return this.now<e},render:async function(){const t=this.model.toJSON();t.selected=!!this.selectedCollection.findWhere({UID:t.UID}),t.attributes=this.model.attributes,t.activeColumns=this.app.activeColumns,t.availableColumns=this.app.availableColumns,t.portal_type=t.portal_type?t.portal_type:"",t.contenttype=t.portal_type.toLowerCase().replace(/\.| /g,"-"),t._authenticator=c.A.getAuthenticator(),t.thumb_scale=this.app.thumb_scale,t.mimeIcon=await c.A.resolveIcon(`contenttype/${t.contenttype}`);const e=this.app.typeToViewAction&&this.app.typeToViewAction[t.attributes.portal_type]||"";t.viewURL=t.attributes.getURL+e,t._t=l.Ay,t.convertColumnValue=this.convertColumnValue.bind(this),t.expired=this.expired(t),t.ineffective=this.ineffective(t),t.exclude_from_nav=t.exclude_from_nav||!1,this.$el.html(this.template(t));const i=this.model.attributes;this.$el.addClass([`state-${i.review_state}`,`type-${i.portal_type}`]),this.$el.attr("data-path",t.path),this.$el.attr("data-UID",t.UID),this.$el.attr("data-id",t.id),this.$el.attr("data-type",t.portal_type),this.$el.attr("data-folderish",t.is_folderish),this.$el.toggleClass("folder",t.is_folderish),this.$el.toggleClass("default-page",t.id===this.table.contextInfo?.defaultPage),this.$el.toggleClass("expired",t.expired),this.$el.toggleClass("ineffective",t.ineffective),this.el.model=this.model;const s=new $({app:this.app,model:this.model});return n()(".actionmenu-container",this.$el).append(await s.render()),this},convertColumnValue:function(t,e){if(this.table.dateColumns.includes(t)){const t=new Date(e);return t instanceof Date&&"Invalid Date"===t.toString()?e:t.toLocaleString(this.app.language,this.app.dateFormat)}return this.table.translatableColumns.includes(t)?(0,l.YA)(e):e},itemClicked:function(t){const e=this.app.keyEvent;if(e&&e.ctrlKey||!this.model.attributes.is_folderish)return null;t.preventDefault(),this.app.setCurrentPath(this.model.attributes.path),this.app.collection.getFirstPage()},itemSelected:function(){const t=this.$("input")[0],e=this.app.selectedCollection;t.checked?e.add(this.model.clone()):e.removeResult(this.model);const i=this.app.keyEvent;if(i&&i.shiftKey&&this.app.last_selected&&null!==this.app.last_selected.parentNode){let i=n()(this.app.last_selected);const s=i.index(),o=this.$el.index();for(const a of this.app.tableView.$('input[type="checkbox"]')){i=n()(a);const l=i.parents("tr").index();if(l>s&&l<o||l<s&&l>o){this.checked=t.checked;const i=n()(this).closest("tr.itemRow");if(i.length>0){const t=i[0].model,s=e.getByUID(t.attributes.UID);this.checked?s||e.add(t.clone()):s&&e.removeResult(s)}}}}this.app.last_selected=this.el}}),I=i(62298),O=(i(83292),i(37620),i(8633)),T=g.extend({tagName:"div",template:a().template('<div class="fc-breadcrumbs-container">\n  <div class="fc-breadcrumbs">\n    <a href="#" title="<%- _t(\'Root\') %>" aria-label="<%- _t(\'Root\') %>" data-path="/">\n      <%= homeIcon %> /\n    </a>\n    <% pathParts.forEach((part, idx) => {\n      if(part){\n        if(idx > 0){ %>\n          /\n        <% } %>\n        <a href="#" class="crumb" data-path="<%- part %>"><%- part %></a>\n      <% }\n    }); %>\n  </div>\n</div>\n\n<table class="pat-datatables table table-striped table-bordered"\n       data-pat-datatables="<%- datatables_options %>">\n  <thead>\n    <tr>\n      <th class="selection"><label for="selectAllInputCheckbox" class="hiddenStructure" aria-label="<%- _t(\'Select all items on this page\') %>"><%- _t(\'Select all items on this page\') %></label><input id="selectAllInputCheckbox" type="checkbox" class="select-all form-check-input pat-tooltip" title="<%- _t(\'Select all items on this page\') %>"/></th>\n      <th class="title"><%- _t(\'Title\') %></th>\n      <% activeColumns.forEach((column, idx) => { %>\n        <% if(column !== \'Description\' && hasOwnProperty.call(availableColumns, column)) { %>\n          <th><%- availableColumns[column] %></th>\n        <% } %>\n      <% }); %>\n      <th class="actions"><%- _t("Actions") %></th>\n    </tr>\n  </thead>\n  <tbody>\n  </tbody>\n</table>\n'),tableSortable:null,initialize:function(t){var e=this;g.prototype.initialize.apply(e,[t]),e.collection=e.app.collection,e.selectedCollection=e.app.selectedCollection,e.subsetIds=[],e.contextInfo=null,e.tableSortable=null,e.listenTo(e.collection,"sync",e.render),e.listenTo(e.selectedCollection,"remove",e.render),e.listenTo(e.selectedCollection,"reset",e.render),n()("body").on("context-info-loaded",(t,i)=>{e.contextInfo=i,e.setContextInfo()}),e.dateColumns=["ModificationDate","EffectiveDate","CreationDate","ExpirationDate","start","end","last_comment_date"],e.translatableColumns=["review_state"]},events:{"click .fc-breadcrumbs a":"breadcrumbClicked","change .select-all":"selectAll"},setContextInfo:function(){const t=this.contextInfo,e=t&&t.breadcrumbs;if(e&&e.length){const t=this.$(".fc-breadcrumbs a.crumb");a().each(e,(e,i)=>{t.eq(i).html(O.A.escape_html(e.title))})}this.trigger("context-info:set")},render:async function(t){const e={order:[0,"asc"],columnDefs:[{orderable:!1,targets:[0,this.app.activeColumns.length+1]}],paging:!1,searching:!1,info:!1,...this.app.options.datatables_options};if(this.$el.html(this.template({_t:l.Ay,homeIcon:await c.A.resolveIcon("house"),pathParts:this.app.getCurrentPath().split("/").slice(1).filter(t=>t.length>0),activeColumns:this.app.activeColumns,availableColumns:this.app.availableColumns,datatables_options:JSON.stringify(e)})),this.collection.length){const e=n()("tbody",this.$el),i=this.collection.length;let s=0;this.collection.each(async t=>{this.dateColumns.map(e=>{!Object.prototype.hasOwnProperty.call(t.attributes,e)||"None"!==t.attributes[e]&&t.attributes[e]||(t.attributes[e]="")});const n=new A({model:t,app:this.app,table:this});await n.render(),e.append(n.el),s++,s===i&&this.el.dispatchEvent(new Event("table_row_rendering_finished"))});const o=()=>new Promise(t=>C.A.add_event_listener(this.el,"table_row_rendering_finished","table_row_rendering_finished__listener",t,{once:!0}));await o(),C.A.remove_event_listener=(this.el,"table_row_rendering_finished__listener"),x.A.scan(this.$el),this.contextInfo&&t!==this.collection&&this.setContextInfo()}return this.$el.find("table").on("init.dt",()=>{this.app.options.moveUrl&&this.addReordering(),this.storeOrder()}).on("order.dt",(t,e,i)=>{if(1===i.length){const t=i[0];if(0===t.col&&"asc"===t.dir)return this.tableSortable&&this.tableSortable.enableSort(),void this.app.clearStatus("sorting_dndreordering_disabled")}const s=t.target,o=n()('<button type="button" class="btn btn-danger btn-sm"></button>').text((0,l.Ay)("Reset column sorting")).on("click",()=>{const t=n()(s).dataTable().api();t.order([0,"asc"]),t.draw()});this.app.setStatus({text:(0,l.Ay)("Notice: Drag and drop reordering is disabled when viewing the contents sorted by a column."),type:"warning"},o,!1,"sorting_dndreordering_disabled"),this.tableSortable&&this.tableSortable.disableSort(),this.$el.removeClass("order-support")}),this},breadcrumbClicked:function(t){t.preventDefault();let e=n()(t.target);"A"!==e[0].tagName&&(e=e.parent("a"));let i="";for(const t of n()(e.prevAll("a").get().reverse())){let e=n()(t).attr("data-path");i+=e,"/"!==e&&(i+="/")}i+=e.attr("data-path"),this.app.setCurrentPath(i),this.app.collection.getPage(this.app.collection.state.firstPage)},selectAll:function(t){n()(t.target).is(":checked")?n()('input[type="checkbox"]',this.$("tbody")).prop("checked",!0).trigger("change"):(this.selectedCollection.remove(this.collection.models,{silent:!0}),this.selectedCollection.trigger("remove")),this.setContextInfo()},addReordering:function(){this.app.inQueryMode()?this.$el.removeClass("order-support"):(this.$el.addClass("order-support"),this.tableSortable=new I.A(this.$("tbody"),{selector:"tr",createDragItem:(t,e)=>{const i=e.clone(),s=n()("<table><tbody></tbody></table>");return n()("tbody",s).append(i),s.addClass("structure-dragging").css({opacity:.85,position:"absolute"}),s.width(e.width()),s.height(e.height()),s.appendTo(document.body),s},drop:(t,e)=>{0!==e&&(this.app.moveItem(t.attr("data-id"),e,this.subsetIds),this.storeOrder())}}))},storeOrder:function(){const t=[];this.$("tbody tr.itemRow").each(function(){t.push(n()(this).attr("data-id"))}),this.subsetIds=t}}),D=i(57642),V=m.extend({tagName:"div",className:"popover",eventPrefix:"popover",template:'<div class="arrow"></div>\n<div class="popover-title">\n</div>\n<div class="items popover-content">\n</div>\n\n',content:null,title:null,triggerView:null,idPrefix:"popover-",triggerEvents:{"button:click":"toggle"},placement:"bottom",events:{},opened:!1,closeOnOutClick:!0,appendInContainer:!0,backdrop:void 0,$backdrop:null,useBackdrop:!0,backdropOptions:{zIndex:"1009",opacity:"0.4",className:"backdrop backdrop-popover",classActiveName:"backdrop-active",closeOnEsc:!1,closeOnClick:!0},initialize:function(t){var e=this;m.prototype.initialize.apply(this,[t]),this.bindTriggerEvents(),this.on("render",function(){this.$el.attr("role","tooltip").attr("aria-hidden","false"),this.renderTitle(),this.renderContent()},this),this.$el.on("keyup",function(t){27===t.keyCode&&e.hide()})},afterRender:function(){},getTemplateOptions:function(){return this.options},renderTitle:function(){var t=this.title;"function"==typeof t&&(t=t(this.getTemplateOptions())),this.$(".popover-title").empty().append(t)},renderContent:function(){this.$(".popover-content").empty().append(this.content(this.getTemplateOptions()))},bindTriggerEvents:function(){this.triggerView&&a().each(this.triggerEvents,function(t,e){var i=this[t];i||n().error("Function not found."),this.stopListening(this.triggerView,e),this.listenTo(this.triggerView,e,i)},this)},getPosition:function(){var t=this.triggerView.$el;return n().extend({},{width:t[0].offsetWidth,height:t[0].offsetHeight},t.offset())},getBodyClassName:function(){var t="popover-";return this.options.id&&(t+=this.options.id+"-"),t+="active"},show:function(){n()(".popover:visible").each(function(){var t=n()(this).data("component");t&&t.hide()}),this.position(),this.setBackdrop(),!0===this.useBackdrop&&this.backdrop.show(),this.opened=!0,this.triggerView&&this.triggerView.$el.addClass("active"),this.uiEventTrigger("show",this),this.$el.attr("aria-hidden","false"),n()("body").addClass(this.getBodyClassName())},position:function(){var t,e,i,s,n=this.getPosition(),o=this.$el;switch(e=this.placement,o.css({top:0,left:0}).addClass("active"),i=o[0].offsetWidth,s=o[0].offsetHeight,e){case"bottom-right":t={top:n.top+n.height,left:n.left+n.width-40};break;case"bottom":t={top:n.top+n.height,left:n.left+n.width/2-i/2};break;case"top":t={top:n.top-s,left:n.left+n.width/2-i/2};break;case"left":t={top:n.top+n.height/2-s/2,left:n.left-i};break;case"right":t={top:n.top+n.height/2-s/2,left:n.left+n.width}}this.applyPlacement(t,e)},applyPlacement:function(t,e){var i,s,n,o,a=this.$el,l=this.$el,r=l[0].offsetWidth,c=l[0].offsetHeight;a.removeClass(e),a.offset(t).addClass(e).addClass("active"),i=l[0].offsetWidth,s=l[0].offsetHeight,"top"===e&&s!==c&&(t.top=t.top+c-s,o=!0),"bottom"===e||"top"===e?(n=0,t.left<0&&(n=-2*t.left,t.left=0,a.removeClass(e),a.offset(t).addClass(e),i=l[0].offsetWidth,s=l[0].offsetHeight),this.positionArrow(n-r+i,i,"left")):"bottom-right"!==e&&this.positionArrow(s-c,s,"top"),o&&a.offset(t)},positionArrow:function(t,e,i){this.$(".arrow").css(i,t?50*(1-t/e)+"%":"")},hide:function(){this.opened=!1,this.$el.removeClass("active"),this.triggerView&&(this.triggerView.$el.removeClass("active"),this.triggerView.$el.attr("aria-hidden","true")),this.uiEventTrigger("hide",this),this.$el.attr("aria-hidden","true"),n()("body").removeClass(this.getBodyClassName())},toggle:function(t,e){this.opened?this.hide():this.show()},setBackdrop:function(){if(!0===this.useBackdrop&&void 0===this.backdrop){var t=this;this.$backdrop=this.$el.closest(".ui-backdrop-element"),0===this.$backdrop.length&&(this.$backdrop=n()("body")),this.backdrop=new D.A(this.$backdrop,this.backdropOptions),this.backdrop.$el.on("hidden.backdrop.patterns",function(e){"backdrop.patterns"===e.namespace&&(e.stopPropagation(),!0===t.opened&&t.hide())}),this.on("popover:hide",function(){this.backdrop.hide()},this)}}}),U=V.extend({className:"popover change-selection",title:(0,l.Ay)("Manage selection"),content:a().template('<div class="list-group"><a href="#" class="list-group-item list-group-item-action select-all"><%= selectAllIcon %> <%- _t("Select all items in the folder") %></a><a href="#" class="list-group-item list-group-item-action select-all-visible"><%= selectPageIcon %> <%- _t("Select all items on this page") %></a><a href="#" class="list-group-item list-group-item-action remove-all"><%= removeIcon %> <%- _t("Cancel selection") %></a></div>'),events:{"click .select-all":"selectAll","click .select-all-visible":"selectVisible","click .remove-all":"removeAll"},initialize:function(t){V.prototype.initialize.apply(this,[t]);let e=0;this.listenTo(this.collection,"reset all add remove",()=>{clearTimeout(e),e=setTimeout(()=>{this.render()},50)}),this.options.item_template=a().template('<span class="selected-item">\n  <a href="#" data-uid="<%- UID %>" title="remove" class="remove">\n    <%= removeIcon %>\n  </a>\n  <%- Title %>\n</span>\n')},render:async function(){return this.options.removeIcon=await c.A.resolveIcon("x-circle"),this.options.selectAllIcon=await c.A.resolveIcon("check2-all"),this.options.selectPageIcon=await c.A.resolveIcon("check2"),V.prototype.render.call(this),0===this.collection.length&&this.$el.removeClass("active"),this},selectAll:function(t){new P({app:this.options.app,model:{attributes:this.options.app.options},selectedCollection:this.options.collection}).selectAll(t),this.options.app.tableView.setContextInfo(),this.hide()},selectVisible:function(t){t.preventDefault(),this.collection.reset(),n()('input[type="checkbox"]',this.app.tableView.$("tbody")).prop("checked",!0).change(),this.hide()},removeAll:function(t){t.preventDefault(),this.collection.reset(),this.hide()}}),N=V.extend({events:{"click button.applyBtn":"applyButtonClicked","click button.closeBtn":"toggle"},submitText:(0,l.Ay)("Apply"),initialize:function(t){this.app=t.app,this.className="popover "+t.id,this.title=t.form.title||t.title,this.submitText=t.form.submitText||(0,l.Ay)("Apply"),this.submitContext=t.form.submitContext||"primary",this.data={},this.options=t,this.setContent(t.form.template),V.prototype.initialize.apply(this,[t])},setContent:function(t){let e="<form>"+t+"</form>";e+='<button class="btn btn-block btn-'+this.submitContext+' applyBtn">'+this.submitText+" </button>",this.options.form.closeText&&(e+='<button class="btn btn-block btn-secondary closeBtn">'+this.options.form.closeText+" </button>"),this.content=a().template(e)},getTemplateOptions:function(){const t=[];for(const e of this.app.selectedCollection.models){let i=e.toJSON();i.Title=O.A.escape_html(i.Title),t.push(i)}return n().extend({},!0,this.options,{items:t,data:this.data})},applyButtonClicked:function(){const t={};for(const e of this.$el.find("form").serializeArray())e.name in t?t[e.name]+=","+e.value:t[e.name]=e.value;this.app.buttonClickEvent(this.triggerView,t),this.hide()},afterRender:function(){if(this.options.form.dataUrl){this.$(".popover-content").html((0,l.Ay)("Loading...")),this.app.loading.show();const t=this.app.getAjaxUrl(this.options.form.dataUrl);n().ajax({url:t,dataType:"json",type:"POST",cache:!1,data:{selection:JSON.stringify(this.app.getSelectedUids()),transitions:!0,render:"yes"}}).done(t=>{this.data=t.data||t,this.renderContent(),x.A.scan(this.$el)}).fail(()=>{const t=this.content;this.setContent("<p>"+(0,l.Ay)("Error loading popover from server.")+"</p>",!1),this.renderContent(),this.content=t}).always(()=>{this.app.loading.hide(),this.position()})}else x.A.scan(this.$el),this.position()},toggle:function(t,e){V.prototype.toggle.apply(this,[t,e]),this.opened&&(this.$el.replaceWith(this.render().el),this.position())}}),z=V.extend({className:"popover rearrange",title:a().template('<%- _t("Rearrange items in this folder") %>'),content:a().template('<div class="form-group"><label><%- _t("What to rearrange on") %></label><select name="rearrange_on" class="form-select"><% _.each(rearrangeProperties, function(title, property) { %><option value="<%- property %>"><%- title %></option><% }); %></select><p class="help-block"><b><%- _t("This permanently changes the order of items in this folder. This operation may take a long time depending on the size of the folder.") %></b></p></div><div class="form-check"><input class="form-check-input" type="checkbox" name="reversed" /><label class="form-check-label"><%- _t("Reverse") %></label></div><button class="btn btn-block btn-primary btn-sm"><%- _t("Rearrange") %></button>'),events:{"click button":"rearrangeButtonClicked"},initialize:function(t){this.app=t.app,V.prototype.initialize.apply(this,[t]),this.options.rearrangeProperties=this.app.options.rearrange.properties},render:function(){return V.prototype.render.call(this),this.$rearrangeOn=this.$('[name="rearrange_on"]'),this.$reversed=this.$('[name="reversed"]'),this},rearrangeButtonClicked:function(){if("/"===this.app.collection.getCurrentPath()&&!window.confirm((0,l.Ay)("Sorting the content on the base of the site could affect your navigation order. Are you certain you want to do this?")))return;const t={rearrange_on:this.$rearrangeOn.val(),reversed:!1};this.$reversed[0].checked&&(t.reversed=!0),this.app.buttonClickEvent(this.triggerView,t),this.hide()}}),R=w.extend({collection:null,template:'<%- _t("${current} of ${total} selected", { current: current, total: total })  %>',initialize:function(t){w.prototype.initialize.apply(this,[t]),this.timeout=0,null!==this.collection&&this.collection.on("add remove reset",()=>{clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.render(),0===this.collection.length&&this.$el.removeClass("active")},50)},this),this.appCollection.on("reset sync",this.render,this)},serializedModel:function(){return{current:null!==this.collection?this.collection.length:0,total:this.appCollection.state.totalRecords?this.appCollection.state.totalRecords:0}}});p.A.getLogger("pat-structure/table").setLevel("DEBUG");var E=f().View.extend({events:{"click a.servernext":"nextResultPage","click a.serverprevious":"previousResultPage","click a.serverlast":"gotoLast","click a.page":"gotoPage","click a.serverfirst":"gotoFirst","click a.serverpage":"gotoPage","click .serverhowmany a":"changeCount"},tagName:"aside",template:a().template('  <ul class="pagination pagination-sm pagination-centered">\n    <li class="page-item <% if (currentPage === 1) { %>disabled<% } %>">\n      <a href="#" class="page-link serverfirst">\n        &laquo;\n      </a>\n    </li>\n    <li class="page-item <% if (currentPage === 1) { %>disabled<% } %>">\n      <a href="#" class="page-link serverprevious">\n        &lt;\n      </a>\n    </li>\n    <% _.each(pages, (p) => { %>\n    <li class="page-item <% if (currentPage == p) { %>active<% } else if ( p == \'...\' ) { %>disabled<% }%>">\n      <a href="#" class="page-link page"><%- p %></a>\n    </li>\n    <% }); %>\n    <li class="page-item <% if (currentPage === totalPages) { %>disabled<% } %>">\n      <a href="#" class="page-link servernext">\n        &gt;\n      </a>\n    </li>\n    <li class="page-item <% if (currentPage === totalPages) { %>disabled<% } %>">\n      <a href="#" class="page-link serverlast">\n        &raquo;\n      </a>\n    </li>\n  </ul>\n\n  <div class="pagination-info"><%- _t("Show:") %></div>\n\n  <ul class="pagination pagination-sm">\n    <li class="page-item serverhowmany serverhowmany15 <% if(pageSize == 15){ %>disabled<% } %>">\n      <a href="#" class="page-link">15</a>\n    </li>\n    <li class="page-item serverhowmany serverhowmany30 <% if(pageSize == 30){ %>disabled<% } %>">\n      <a href="#" class="page-link">30</a>\n    </li>\n    <li class="page-item serverhowmany serverhowmany50 <% if(pageSize == 50){ %>disabled<% } %>">\n      <a href="#" class="page-link">50</a>\n    </li>\n    <li class="page-item serverhowmany serverhowmany250 <% if(pageSize == 250){ %>disabled<% } %>">\n      <a href="#" class="page-link">250</a>\n    </li>\n  </ul>\n\n  <div class="pagination-info">\n    <% if(totalPages){ %>\n    <%- _t("Page:") %> <span class="current"><%- currentPage %></span>\n    <%- _t("of") %>\n    <span class="total"><%- totalPages %></span>\n          <%- _t("shown") %>\n    <% } %>\n  </div>\n'),maxPages:7,initialize:function(t){this.options=t,this.app=this.options.app,this.collection=this.app.collection,this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"sync",this.render)},render:function(){const t=this.collection.state;t.pages=this.getPages(t);const e=this.template(n().extend({_t:l.Ay},t));return this.$el.html(e),this},getPages:function(t){const e=t.totalPages;if(!e)return[];let i=1,s=e;e>this.maxPages&&(i=Math.max(1,Math.floor(t.currentPage-this.maxPages/2)),s=Math.min(i+this.maxPages,e),s-i<this.maxPages&&(i-=Math.floor(this.maxPages/2)));let n=[];for(let t=i;t<=s;t+=1)n.push(t);return n[0]>1&&(n[0]>2&&(n=["..."].concat(n)),n=[1].concat(n)),n[n.length-1]<e-1&&(n[n.length-2]<e-2&&n.push("..."),n.push(e)),n},nextResultPage:function(t){t.preventDefault(),this.app.clearStatus(),this.collection.getNextPage()},previousResultPage:function(t){t.preventDefault(),this.app.clearStatus(),this.collection.getPreviousPage()},gotoFirst:function(t){t.preventDefault(),this.app.clearStatus(),this.collection.getPage(this.collection.state.firstPage)},gotoLast:function(t){t.preventDefault(),this.app.clearStatus(),this.collection.getPage(this.collection.state.totalPages)},gotoPage:function(t){t.preventDefault(),this.app.clearStatus();const e=parseInt(n()(t.target).text());this.collection.getPage(e)},changeCount:function(t){t.preventDefault(),this.app.clearStatus();const e=parseInt(n()(t.target).text());this.collection.setPageSize(e,{first:!0}),this.app.setCookieSetting("pageSize",e)}}),q=V.extend({className:"popover attribute-columns",title:a().template('<%- _t("Columns") %>'),content:a().template('\n        <label>\n            <%- _t("Select columns to show, drag and drop to reorder") %>\n        </label>\n        <ul>\n        </ul>\n        <button class="btn btn-block btn-primary btn-sm"><%- _t("Save") %></button>'),itemTemplate:a().template('\n        <li>\n            <div class="form-check form-switch">\n                <input class="form-check-input" type="checkbox" role="switch" id="columnswitch-<%- id %>" value="<%- id %>"/>\n                <label class="form-check-label" for="columnswitch-<%- id %>"><%- title %></label>\n            </div>\n        </li>'),events:{"click button":"applyButtonClicked"},initialize:function(t){this.app=t.app,V.prototype.initialize.apply(this,[t])},afterRender:function(){this.$container=this.$("ul");for(const t of this.app.activeColumns){const e=n()(this.itemTemplate({title:this.app.availableColumns[t],id:t}));e.find("input")[0].checked=!0,this.$container.append(e)}const t=a().keys(a().omit(this.app.availableColumns,this.app.activeColumns)).sort((t,e)=>{const i=this.app.availableColumns[t],s=this.app.availableColumns[e];return i<s?-1:i==s?0:1});for(const e of t){const t=n()(this.itemTemplate({title:this.app.availableColumns[e],id:e}));this.$container.append(t)}return new I.A(this.$container,{selector:"li"}),this},async applyButtonClicked(){this.hide(),this.app.activeColumns=[];for(const t of this.$("input:checked"))this.app.activeColumns.push(n()(t).val());this.app.setCookieSetting(this.app.activeColumnsCookie,this.app.activeColumns),await this.app.tableView.render()}}),B=i(3596),M=g.extend({tagName:"div",className:"navbar-search form-search ui-offset-parent",template:a().template('<div class="input-group"><input id="textFilterInput" type="text" class="form-control search-query" aria-label="<%- _t("Search") %>" placeholder="<%- _t("Search") %>"></div>'),popoverContent:a().template('<input class="pat-querystring" />'),events:{"keyup .search-query":"filter"},term:null,timeoutId:null,keyupDelay:300,statusKeyFilter:"textfilter_status_message_filter",statusKeySorting:"textfilter_status_message_sorting",initialize:function(t){g.prototype.initialize.apply(this,[t]),this.app=this.options.app},setFilterStatusMessage:function(){const t=n()('<button type="button" class="btn btn-primary btn-sm"></button>').text((0,l.Ay)("Clear")).on("click",()=>this.clearFilter()),e=(0,l.Ay)("This listing has filters applied. Not all items are shown.");this.app.setStatus({text:e,type:"success"},t,!0,this.statusKeyFilter);const i=(0,l.Ay)("Drag and drop reordering is disabled while filters are applied.");this.app.setStatus({text:i,type:"warning"},null,!0,this.statusKeySorting)},clearFilterStatusMessage:function(){this.term||this.app.additionalCriterias.length||(this.app.clearStatus(this.statusKeyFilter),this.app.clearStatus(this.statusKeySorting))},setTerm:function(t,e){const i=this.$el[0].querySelector(".search-query");if(this.term=encodeURIComponent(t),e&&(i.value=t),this.app.collection.currentPage=1,this.app.collection.fetch(),t)i.classList.add("has-filter"),this.setFilterStatusMessage();else{let t=!1;try{const e=this.$queryString.val();e&&JSON.parse(e).length>0&&(t=!0)}finally{t||(i.classList.remove("has-filter"),this.clearFilterStatusMessage())}}},setQuery:function(t,e){let i=null,s=null;try{"string"==typeof t?(s=JSON.parse(t),i=t):(i=JSON.stringify(t),s=t)}catch{s=[],i="[]"}e&&this.$queryString.val(i),this.app.additionalCriterias=s,this.app.collection.currentPage=1,this.app.collection.fetch(),s.length?(this.button.$el[0].classList.add("has-filter"),this.setFilterStatusMessage()):this.term||(this.button.$el[0].classList.remove("has-filter"),this.clearFilterStatusMessage())},clearTerm:function(){this.setTerm("",!0)},clearFilter:function(){this.setTerm("",!0),this.setQuery([],!0)},render:function(){return this.$el.html(this.template({_t:l.Ay})),this.button=new w({title:(0,l.Ay)("Filter"),icon:"filter",extraClasses:["btn-queryfilter"]}),this.popover=new V({triggerView:this.button,id:"structure-query",title:a().template((0,l.Ay)("Filter")),content:this.popoverContent,placement:"left"}),this.$el.find(".input-group").append(this.button.render().el),this.$el.append(this.popover.render().el),this.popover.$el.addClass("query"),this.$queryString=this.popover.$("input.pat-querystring"),this.queryString=new B.A(this.$queryString,{indexOptionsUrl:this.app.options.indexOptionsUrl,showPreviews:!1}),this.queryString.$el.on("change",()=>{this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.setQuery(this.$queryString.val(),!1)},this.keyupDelay)}),this.queryString.$el.on("initialized",()=>{this.queryString.$sortOn.on("change",()=>{this.app.sort_on=this.queryString.$sortOn.val(),this.app.collection.currentPage=1,this.app.collection.fetch()}),this.queryString.$sortOrder.change(()=>{this.queryString.$sortOrder[0].checked?this.app.sort_order="reverse":this.app.sort_order="ascending",this.app.collection.currentPage=1,this.app.collection.fetch()})}),this},filter:function(t){this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{const e=n()(t.currentTarget);this.setTerm(e.val(),!1)},this.keyupDelay)}}),j=i(8936),L=V.extend({className:"popover upload",title:a().template('<%- _t("Upload files") %>'),content:a().template('<input type="text" name="upload" style="display:none" /><div class="uploadify-me"></div>'),initialize(t){this.app=t.app,V.prototype.initialize.apply(this,[t]),this.currentPathData=null,n()("body").on("context-info-loaded",(t,e)=>{this.currentPathData=e})},render(){V.prototype.render.call(this);var t=this.app.options.upload;return t.success=()=>{this.app.collection.fetch()},t.currentPath=this.app.getCurrentPath(),t.allowPathSelection=!1,this.upload=new j.default(this.$(".uploadify-me").addClass("pat-upload"),t),this},toggle(t,e){if(V.prototype.toggle.apply(this,[t,e]),this.opened){var i=this.app.getCurrentPath();this.currentPathData&&i!==this.upload.currentPath&&this.upload.setPath(i)}}}),F=f().Collection.extend({model:S,removeResult:function(t){return this.removeByUID(t.uid())},removeByUID:function(t){var e=this.getByUID(t);return e&&this.remove(e),e},getByUID:function(t){return this.findWhere({UID:t})}}),J=(i(8364),f().PageableCollection.extend({model:S,mode:"server",initialize:function(t,e){this.options=e,this.view=e.view,this.url=e.url,this.queryHelper=c.A.QueryHelper({attributes:this.view.options.queryHelperAttributes,...this.view.options}),this.queryParser=function(t){void 0===t&&(t={});const e=this.view?.toolbar?.get?.("filter")?.term||null,i=this.view?.sort_on||"getObjPositionInParent",s=this.view.sort_order;return JSON.stringify({criteria:this.queryHelper.getCriterias(e,{additionalCriterias:this.view.additionalCriterias,...t}),sort_on:i,sort_order:s})},"#/"===window.location.hash.substring(0,2)&&(this.queryHelper.currentPath=window.location.hash.substring(1)),f().PageableCollection.prototype.initialize.apply(this,[t,e])},getCurrentPath:function(){return this.queryHelper.getCurrentPath()},setCurrentPath:function(t){this.queryHelper.currentPath=t},queryParams:{query:function(){return this.queryParser()},batch:function(){return this.queryHelper.options.batchSize=this.state.pageSize,JSON.stringify(this.queryHelper.getBatch(this.state.currentPage))},attributes:function(){return JSON.stringify(this.queryHelper.options.attributes)}},parseState:function(t,e,i,s){this.state.totalRecords=t.total,this.state.totalPages=Math.ceil(t.total/i.pageSize)},parseRecords:function(t,e){const i=t.results;return i.forEach((t,e)=>{t._sort=e}),i}}));const H=p.A.getLogger("pat-structure/app");var W=g.extend({tagName:"div",statusTemplate:a().template('<div class="alert alert-<%- type %> status fc-status">\n  <strong class="fc-status-label"><%- label %></strong>\n  <span class="fc-status-text">\n    <% if(text){ %>\n    <%- text %>\n    <% } else { %>\n    &nbsp;<% // &nbsp; to get correct height for empty alerts %>\n    <% } %>\n  </span>\n</div>\n'),statusMessages:[],sort_on:"getObjPositionInParent",sort_order:"ascending",additionalCriterias:[],cookieSettingPrefix:"_fc_",buttons:null,textfilter:null,forms:[],pasteAllowed:function(){return!!d().get("__cp")},initialize:function(t){g.prototype.initialize.apply(this,[t]),this.loading=new c.A.Loading,this.loading.show(),n()(document).on("click",t=>{const e=n()(t.target);if(!e.is(":visible")||"hidden"===e.css("visibility")||"0"===e.css("opacity"))return;if(e.is("a")||e.parent().is("a")||e.hasClass("popover-structure-query-active"))return;const i=n()(".popover:visible");if(i.length>0&&!n().contains(i[0],e[0])){const t=i.data("component");t&&t.hide()}}),this.collection=new J([],{view:this,url:this.options.collectionUrl}),this.activeColumns=this.getCookieSetting(this.activeColumnsCookie,this.activeColumns),this.selectedCollection=new F,this.pagingView=new E({app:this}),this.tableView=new T({app:this}),this.collection.state.pageSize=this.getCookieSetting("pageSize",15),this.collection.fetch(),this.setupButtons(),this.wellView=new U({collection:this.selectedCollection,triggerView:this.toolbar.get("change-selection"),app:this,id:"change-selection"}),this.buttons.disable();let e=0;this.selectedCollection.on("add remove reset",()=>{clearTimeout(e),e=setTimeout(()=>{this.updateButtons()},100)},this),this.collection.on("sync",()=>{if(this.contextInfoUrl&&n().ajax({url:this.getAjaxUrl(this.contextInfoUrl),dataType:"json",success:t=>{n()("body").trigger("context-info-loaded",[t])},error:t=>{404===t.status&&H.info("context info url not found")}}),this.doNotPushState)return void(this.doNotPushState=!1);this.loading.show(),this.updateButtons();let t,e=this.getCurrentPath();if("/"===e&&(e=""),this.options.pushStateUrl){t=this.options.pushStateUrl.replace("/{path}","{path}").replace("{path}",e),window.history.pushState(null,null,t)}else this.options.urlStructure&&(t=this.options.urlStructure.base+e+this.options.urlStructure.appended,window.history.pushState(null,null,t));this.options.traverseView&&(e=""),n()("body").trigger("structure-url-changed",[e]),this.loading.hide()}),(this.options.pushStateUrl||this.options.urlStructure)&&c.A.featureSupport.history()&&(n()(window).on("popstate",()=>{let t,e,i=c.A.getWindow().location.href;if(-1!==i.indexOf("?")&&(i=i.split("?")[0]),-1!==i.indexOf("#")&&(i=i.split("#")[0]),this.options.pushStateUrl){const i=this.options.pushStateUrl.split("{path}");t=i[0],e=i[1]}else t=this.options.urlStructure.base,e=this.options.urlStructure.appended;let s=i.substring(t.length);s.substring(s.length-e.length)===e&&(s=s.substring(0,s.length-e.length)),s||(s="/"),this.setCurrentPath(s),n()("body").trigger("structure-url-changed",[s]),this.doNotPushState=!0,this.collection.getPage(this.collection.state.firstPage)}),n()(document).on("keyup keydown",t=>{this.keyEvent=t})),this.togglePasteBtn()},updateButtons:function(){this.selectedCollection.length?this.buttons.enable():this.buttons.disable(),this.togglePasteBtn()},togglePasteBtn:function(){a().find(this.buttons.items,t=>"paste"===t.id)&&(this.pasteAllowed()?this.buttons.get("paste").enable():this.buttons.get("paste").disable())},inQueryMode:function(){return!(!this.toolbar||!this.toolbar.get("filter").term)||(this.additionalCriterias.length>0||(!(!this.sort_on||"getObjPositionInParent"===this.sort_on)||"ascending"!==this.sort_order))},getSelectedUids:function(t){void 0===t&&(t=this.selectedCollection);const e=[];return t.each(function(t){e.push(t.uid())}),e},getCurrentPath:function(){return this.collection.getCurrentPath()},setCurrentPath:function(t){this.collection.setCurrentPath(t),this.clearStatus(),this.selectedCollection.reset()},getAjaxUrl:function(t){return t.replace("{path}",this.getCurrentPath())},buttonClickEvent:function(t){let e=null,i=null;if(t.url){if(this.loading.show(),arguments.length>1){const t=arguments[1];t.preventDefault||(e=t)}if(arguments.length>2){const t=arguments[2];"function"==typeof t&&(i=t)}null===e&&(e={}),void 0===e.selection&&(e.selection=JSON.stringify(this.getSelectedUids())),e._authenticator=c.A.getAuthenticator(),void 0===e.folder&&(e.folder=this.getCurrentPath());const s=this.getAjaxUrl(t.url);n().ajax({url:s,type:"POST",data:e,success:t=>{this.ajaxSuccessResponse.apply(this,[t,i]),this.loading.hide()},error:t=>{this.ajaxErrorResponse.apply(this,[t,s]),this.loading.hide()}},this)}},ajaxSuccessResponse:function(t,e){this.clearStatus(),this.selectedCollection.reset(),"success"===t.status&&this.collection.reset(),t.msg&&this.setStatus({text:t.msg,type:t.status||"warning"}),null!=e&&e(t),this.collection.fetch()},ajaxErrorResponse:function(t,e){404===t.status?window.alert((0,l.Ay)("operation url ${url} is not valid",{url:e})):window.alert((0,l.Ay)("there was an error performing the action"))},setupButtons:function(){const t=[],e=new w({id:"structure-columns",tooltip:(0,l.Ay)("Configure displayed columns"),icon:"plone-three-dots"});if(this.columnsView=new q({app:this,triggerView:e,id:"structure-columns",placement:"bottom-right"}),t.push(e),t.push(new R({title:(0,l.Ay)("${current} of ${total} selected",{current:0,total:0}),id:"change-selection",tooltip:(0,l.Ay)("Manage selection"),collection:this.selectedCollection,appCollection:this.collection,icon:"plone-selection"})),this.options.rearrange){const e=new w({id:"structure-rearrange",title:(0,l.Ay)("Rearrange"),icon:"plone-rearrange",tooltip:(0,l.Ay)("Rearrange folder contents"),url:this.options.rearrange.url});this.rearrangeView=new z({triggerView:e,app:this,id:"structure-rearrange"}),t.push(e)}if(this.options.upload&&c.A.featureSupport.dragAndDrop()&&c.A.featureSupport.fileApi()){const e=new w({id:"upload",title:(0,l.Ay)("Upload"),tooltip:(0,l.Ay)("Upload files"),icon:"upload"});this.uploadView=new L({triggerView:e,app:this,id:"upload"}),t.push(e)}const i=[];for(const t of this.options.buttons)try{const e=new w(t);if(i.push(e),e.form){t.triggerView=e,t.app=this;const i=new N(t);this.forms.push(i.el)}else e.on("button:click",()=>this.buttonClickEvent(e),this)}catch(e){H.error(`Error initializing button ${t.title||t.id} ${e}`)}this.buttons=new v({items:i,id:"mainbuttons",app:this}),t.push(this.buttons),this.textfilter=new M({id:"filter",app:this}),t.push(this.textfilter),this.toolbar=new b({items:t})},moveItem:function(t,e,i){n().ajax({url:this.getAjaxUrl(this.options.moveUrl),type:"POST",data:{delta:e,id:t,_authenticator:c.A.getAuthenticator(),subsetIds:JSON.stringify(i)},dataType:"json",success:t=>{this.clearStatus(),t.msg?this.setStatus({text:t.msg}):"success"!==t.status&&this.setStatus({text:(0,l.Ay)("Error moving item"),type:"danger"}),this.collection.fetch()},error:()=>{this.clearStatus(),this.setStatus({text:(0,l.Ay)("Error moving item"),type:"danger"})}})},clearStatus:function(t){const e=this.$el[0].querySelector(".fc-status-container");let i=[];t?(i=this.statusMessages.filter(function(e){return e.key===t}),i.forEach(function(t){try{e.removeChild(t.el)}catch{}}),this.statusMessages=this.statusMessages.filter(function(e){return e.key!==t})):(this.statusMessages.forEach(function(t){if(!t.fixed)try{e.removeChild(t.el),i.push(t)}catch{}}.bind(this)),this.statusMessages=this.statusMessages.filter(function(t){return-1===i.indexOf(t)}))},setStatus:function(t,e,i,s){if(s&&this.statusMessages.filter(function(t){return t.key===s}).length>0)return;const o=r.A.create_from_string(this.statusTemplate({label:t.label||"",text:t.text,type:t.type||"warning"})).lastChild;e&&(e=n()(e)[0],o.appendChild(e)),t={el:o,fixed:i,key:s};return this.$el[0].querySelector(".fc-status-container").appendChild(t.el),this.statusMessages.push(t),t},render:async function(){this.$el.append(this.toolbar.render().el),this.wellView&&this.$el.find("#btn-"+this.wellView.id).after((await this.wellView.render()).el);for(const t of this.forms){const e=n()(t).attr("id"),i=this.$el.find("#btn-"+e);i.closest(".btn-group").length?i.closest(".btn-group").after(t):this.$el.find("#btn-"+e).after(t)}return this.$el.append(r.A.create_from_string('<div class="fc-status-container"></div>')),this.columnsView&&this.$el.find("#btn-"+this.columnsView.id).after(this.columnsView.render().el),this.rearrangeView&&this.$el.find("#btn-"+this.rearrangeView.id).after(this.rearrangeView.render().el),this.uploadView&&this.$el.find("#btn-"+this.uploadView.id).after(this.uploadView.render().el),this.$el.append(this.tableView.el),this.$el.append(this.pagingView.el),null!==this.options.backdropSelector?n()(this.options.backdropSelector).addClass("ui-backdrop-element"):this.$el.addClass("ui-backdrop-element"),this},getCookieSetting:function(t,e){let i;void 0===e&&(e=null);try{i=d().get(this.cookieSettingPrefix+t),i=JSON.parse(i).value}catch{return e}return null==i?e:i},setCookieSetting:function(t,e){d().set(this.cookieSettingPrefix+t,JSON.stringify({value:e}))}})}}]);
//# sourceMappingURL=3464.576edcde0d96b490c818.min.js.map