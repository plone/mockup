{"version":3,"file":"chunks/15353.d37cc0c635bbfed066d7.min.js","mappings":"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","sources":["webpack://@plone/mockup/./src/pat/controlpanels/discussion-moderation--implementation.js"],"sourcesContent":["import registry from \"@patternslib/patternslib/src/core/registry\";\nimport $ from \"jquery\";\n\nexport default class Contentrules {\n    constructor(el) {\n        this.el = el;\n    }\n\n    init_moderation_eventhandler() {\n        let self = this;\n        /**********************************************************************\n         * Delete a single comment.\n         **********************************************************************/\n        $(\"button[name='form.button.moderation.DeleteComment']\").on(\"click\", function (e) {\n            e.preventDefault();\n            var row = $(this).closest(\"tr\");\n            var path = row.find(\"[name='selected_obj_paths:list']\").attr(\"value\");\n            var auth_key = $('input[name=\"_authenticator\"]').val();\n            var target = path + \"/@@moderate-delete-comment?_authenticator=\" + auth_key;\n            $.ajax({\n                type: \"GET\",\n                url: target,\n                // eslint-disable-next-line no-unused-vars\n                success: function (msg) {\n                    // fade out row\n                    row.fadeOut(250).fadeIn(250, function () {\n                        row.remove();\n                    });\n                    // reload page if all comments have been removed\n                    var comments = $(\"table#review-comments > tbody > tr\");\n                    if (comments.length === 1) {\n                        location.reload();\n                    }\n                },\n                // eslint-disable-next-line no-unused-vars\n                error: function (msg) {\n                    alert(\"Error sending AJAX request:\" + target);\n                },\n            });\n        });\n        /**********************************************************************\n         * Transmit a single comment.\n         **********************************************************************/\n        $('button[name=\"form.button.moderation.TransmitComment\"]').on(\"click\", function (e) {\n            e.preventDefault();\n            var row = $(this).closest(\"tr\");\n            var path = $(row).find(\"[name='selected_obj_paths:list']\").attr(\"value\");\n            var workflow_action = $(this).attr(\"data-transition\");\n            var auth_key = $('input[name=\"_authenticator\"]').val();\n            // distinction of workflow_action\n            var target =\n                path +\n                \"/@@transmit-comment?_authenticator=\" +\n                auth_key +\n                \"&workflow_action=\" +\n                workflow_action;\n            var moderate =\n                $(this).closest(\"fieldset\").attr(\"id\") == \"fieldset-moderate-comments\";\n            $.ajax({\n                type: \"GET\",\n                url: target,\n                // eslint-disable-next-line no-unused-vars\n                success: function (msg) {\n                    if (moderate) {\n                        let url = location.href;\n                        $(\"#review-comments\").load(\n                            url + \" #review-comments > *\",\n                            function () {\n                                self.init_moderation_eventhandler();\n                                $(\".pat-plone-modal\").patPloneModal();\n                            }\n                        );\n                    } else {\n                        location.reload();\n                    }\n                },\n                // eslint-disable-next-line no-unused-vars\n                error: function (msg) {\n                    alert(\n                        \"Error transmitting comment. (Error sending AJAX request:\" +\n                            target +\n                            \")\"\n                    );\n                },\n            });\n        });\n\n        /**********************************************************************\n         * Bulk actions for comments (delete, publish)\n         **********************************************************************/\n        $(\"button[name='form.button.BulkAction']\").on(\"click\", function (e) {\n            e.preventDefault();\n            var form = $(this).closest(\"form\");\n            var target = $(form).attr(\"action\");\n            var params = $(form).serialize();\n            var valArray = $(\"input:checkbox:checked\");\n            var selectField = $(form).find(\"[name='form.select.BulkAction']\");\n\n            if (selectField.val() === \"-1\") {\n                // TODO: translate message\n                alert(\"You haven't selected a bulk action. Please select one.\");\n            } else if (valArray.length === 0) {\n                // TODO: translate message\n                alert(\n                    \"You haven't selected any comment for this bulk action.\" +\n                        \"Please select at least one comment.\"\n                );\n            } else {\n                // eslint-disable-next-line no-unused-vars\n                $.post(target, params, function (data) {\n                    // reset the bulkaction select\n                    selectField.find(\"option[value='-1']\").attr(\"selected\", \"selected\");\n                    // reload filtered comments\n                    $(\"#review-comments\").load(\n                        window.location + \" #review-comments\",\n                        function () {\n                            self.init_moderation_eventhandler();\n                            $(\".pat-plone-modal\").patPloneModal();\n                        }\n                    );\n                });\n            }\n        });\n\n        /**********************************************************************\n         * Check or uncheck all checkboxes from the batch moderation page.\n         **********************************************************************/\n        $(\"input[name='check_all']\").on(\"click\", function () {\n            if ($(this).val() === \"0\") {\n                $(this).parents(\"table\").find(\"input:checkbox\").prop(\"checked\", true);\n                $(this).val(\"1\");\n            } else {\n                $(this).parents(\"table\").find(\"input:checkbox\").prop(\"checked\", false);\n                $(this).val(\"0\");\n            }\n        });\n\n        /**********************************************************************\n         * select comments with review_state\n         **********************************************************************/\n\n        $(\"input[name='review_state']\").on(\"click\", function () {\n            let review_state = $(this).val();\n            let url = location.href;\n            if (location.search) {\n                url = location.href.replace(\n                    location.search,\n                    \"?review_state=\" + review_state\n                );\n            } else {\n                url = location.href + \"?review_state=\" + review_state;\n            }\n\n            $(\"#fieldset-moderate-comments\")\n                .parent()\n                .load(url + \" #content form > *\", function () {\n                    self.init_moderation_eventhandler();\n                    $(\".pat-plone-modal\").patPloneModal();\n                    let stateObj = { review_state: review_state };\n                    history.pushState(stateObj, \"moderate comments\", url);\n                });\n        });\n\n        /**********************************************************************\n         * Show full text of a comment in the batch moderation page.\n         **********************************************************************/\n        $(\".show-full-comment-text\").on(\"click\", function (e) {\n            e.preventDefault();\n            var target = $(this).attr(\"href\");\n            var parent = $(this).parent();\n            $.ajax({\n                type: \"GET\",\n                url: target,\n                data: \"\",\n                success: function (data) {\n                    // show full text\n                    parent.html(data);\n                },\n                // eslint-disable-next-line no-unused-vars\n                error: function (msg) {\n                    alert(\"Error getting full comment text:\" + target);\n                },\n            });\n        });\n\n        /**********************************************************************\n         * Comments published: Load history for publishing date.\n         **********************************************************************/\n        $(\".last-history-entry\").each(function () {\n            var lasthistoryentry = $(this);\n            $.ajax({\n                url: lasthistoryentry.attr(\"data-href\"),\n                success: function (data) {\n                    lasthistoryentry.html($(data).find(\".historyByLine\").first());\n                    // format date\n                    registry.scan(lasthistoryentry);\n                },\n                // eslint-disable-next-line no-unused-vars\n                error: function (msg) {\n                    console.error(\"Error getting history.\");\n                },\n            });\n        });\n    } // end init_moderation_eventhandler\n\n    init() {\n        let self = this;\n        self.init_moderation_eventhandler();\n    }\n}\n"],"names":["Contentrules","constructor","el","this","init_moderation_eventhandler","self","$","on","e","preventDefault","row","closest","target","find","attr","val","type","url","success","msg","fadeOut","fadeIn","remove","length","location","reload","error","alert","path","workflow_action","moderate","href","load","patPloneModal","form","params","serialize","valArray","selectField","data","window","parents","prop","review_state","search","replace","parent","stateObj","history","pushState","html","each","lasthistoryentry","first","registry","scan","console","init"],"sourceRoot":""}