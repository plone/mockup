"use strict";(self.webpackChunk_plone_mockup=self.webpackChunk_plone_mockup||[]).push([[31518],{31518:function(t,e,a){a.r(e),a.d(e,{default:function(){return o}});var i=a(35686),r=a.n(i);class o{constructor(t){this.el=t}init(){r()("#form fieldset",this.el).length>=2?r()("#form .autotoc-nav > a",this.el).length?this.init_schemaeditor():r()(window).on("init.autotoc.patterns",this.init_schemaeditor):this.init_schemaeditor()}init_add_field(t){if(t){var e=r()("a#add-field",this.el);if(!1===r()("#form fieldset#fieldset-"+t,this.el).data("can-add-fields"))e.addClass("disabled");else{var a=e.attr("href").split("?")[0];e.attr("href",a+"?fieldset_id="+t),e.removeClass("disabled")}}}init_schemaeditor(){r()("a.schemaeditor-delete-field",this.el).on("click",function(t){var e=r()(this);t.preventDefault(),window.confirm(e.attr("data-confirm_msg"))&&r().post(e.attr("href"),{_authenticator:r()('input[name="_authenticator"]',this.el).val()},function(t){e.closest(".fieldPreview").detach()},"text")});r()("body").on("focusout","#form-widgets-title, #form-widgets-label",function(){var t=r().plone_schemaeditor_normalize_string(r()(this).val());r()("#form-widgets-__name__",this.el).val(t)}),r()(".fieldPreview.orderable",this.el).plone_schemaeditor_html5_sortable(function(t,e){var a=[location.protocol,"//",location.host,location.pathname.replace("/@@fields",""),"/",this.attr("data-field_id"),"/@@order"].join("");r().post(a,{_authenticator:r()('input[name="_authenticator"]',this.el).val(),pos:t,fieldset_index:e})},function(t){var e=[location.protocol,"//",location.host,location.pathname.replace("/@@fields",""),"/",this.attr("data-field_id"),"/@@changefieldset"].join("");r().post(e,{_authenticator:r()('input[name="_authenticator"]',this.el).val(),fieldset_index:t})});var t=this;r()("#form .autotoc-nav > a",this.el).each(function(){r()(this).on("click",function(e){e.preventDefault();var a=r()(this).attr("data-fieldset_drag_id");t.init_add_field(a)})});var e=r()("#form .autotoc-nav > a.active",this.el).attr("data-fieldset_drag_id");this.init_add_field(e)}}r().plone_schemaeditor_normalize_string=function(t){t=t.toLowerCase();var e={a:/[àáâãäå]/g,ae:/[æ]/g,c:/[ç]/g,e:/[èéêë]/g,i:/[ìíîï]/g,n:/[ñ]/g,o:/[òóôõö]/g,oe:/[œ]/g,u:/[ùúûü]/g,y:/[ýÿ]/g,th:/[ðþ]/g,ss:/[ß]/g,_:/[\s\\]+/g};for(var a in e)t=t.replace(e[a],a);return t.replace(/[^a-z0-9_]/g,"_")},r().fn.plone_schemaeditor_html5_sortable=function(t,e){this.attr("draggable","true").css("-webkit-user-drag","element").each(function(e){r()(this).attr("data-drag_id",e),this.ondragstart=function(t){t.dataTransfer.setData("Text",r()(this).attr("data-drag_id")),t.dataTransfer.setData("draggable",!0),r()('<div id="drop-marker" style="position: absolute; width: 100%;"></div>').insertBefore(this)},this.ondragenter=function(t){return!1},this.ondragleave=function(t){return!1},this.ondragover=function(t){var e=r()(this).position(),a=r()(this).height(),i=r()("#drop-marker");return i.css("border-bottom","5px dotted red"),t.pageY<r()(this).offset().top+a/2?(i.css("top",e.top+1+"px"),r()(this).attr("draghalf","top")):(i.css("top",e.top+a+21+"px"),r()(this).attr("draghalf","bottom")),r()("html,body").is(":animated")||(r()(window).scrollTop()+r()(window).height()-t.pageY<30?r()("html,body").animate({scrollTop:r()(window).scrollTop()+50},200):t.pageY-r()(window).scrollTop()<30&&r()("html,body").animate({scrollTop:r()(window).scrollTop()-50},200)),!1},this.ondrop=function(e){e.preventDefault();var a=e.dataTransfer.getData("Text"),i=r()("[data-drag_id="+a+"]");if(r()(this).attr("data-drag_id")!==a){"top"===r()(this).attr("draghalf")?i.insertBefore(this):i.insertAfter(this);var o=r()(this).parents("fieldset").first().find("legend").attr("data-fieldset_drag_id"),s=i.parent().children("[data-drag_id]").index(i);t.apply(i,[s,o])}},this.ondragend=function(t){r()("#drop-marker").remove()}});var a=this;r()("#form fieldset legend").each(function(t){!0===r()("#form fieldset#fieldset-"+t,a.el).data("can-add-fields")&&r()(this).attr("droppable","true"),r()(this).attr("data-fieldset_drag_id",t)}),r()("#form .autotoc-nav > a").each(function(t){!0===r()("#form fieldset#fieldset-"+t,a.el).data("can-add-fields")&&(r()(this).attr("droppable","true"),this.ondrop=function(t){t.preventDefault();var a=t.dataTransfer.getData("Text"),i=r()("[data-drag_id="+a+"]"),o=i.parents("fieldset").attr("id").split("-")[1],s=r()(this).attr("data-fieldset_drag_id");if(o!=s){var d=r()("#fieldset-"+s),n=r()(this).position();i.animate({top:n.top-i.position().top,left:n.left-i.position().left,width:"50%",opacity:"0"},1e3,function(){i.appendTo(d),i.css("left",""),i.css("top",""),i.css("width",""),i.css("opacity","")}),e.apply(i,[s])}r()(this).css("border","")},this.ondragover=function(t){return t.preventDefault(),t.dataTransfer.getData("draggable")&&(r()(this).css("border","3px dotted red"),r()("#drop-marker").hide()),!1},this.ondragleave=function(t){t.preventDefault(),r()(this).css("border",""),r()("#drop-marker").show()}),r()(this).attr("data-fieldset_drag_id",t)}),r()('<span class="draghandle">&#x28FF;</span>').css("cursor","ns-resize").prependTo(".fieldPreview.orderable .fieldLabel")}}}]);
//# sourceMappingURL=31518.9773836ee5a331d0a9a1.min.js.map