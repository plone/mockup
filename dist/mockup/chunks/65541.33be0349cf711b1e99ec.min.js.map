{"version":3,"file":"chunks/65541.33be0349cf711b1e99ec.min.js","mappings":"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","sources":["webpack://@plone/mockup/./node_modules/backbone.paginator/lib/backbone.paginator.js"],"sourcesContent":["/*\n  backbone.paginator\n  http://github.com/backbone-paginator/backbone.paginator\n\n  Copyright (c) 2016 Jimmy Yuen Ho Wong and contributors\n\n  @module\n  @license MIT\n*/\n\n(function (factory) {\n\n  // CommonJS\n  if (typeof exports == \"object\" && typeof require == \"function\") {\n    module.exports = factory(require(\"underscore\"), require(\"backbone\"));\n  }\n  // AMD\n  else if (typeof define == \"function\" && define.amd) {\n    define([\"underscore\", \"backbone\"], factory);\n  }\n  // Browser\n  else if (typeof _ !== \"undefined\" && typeof Backbone !== \"undefined\") {\n    var oldPageableCollection = Backbone.PageableCollection;\n    var PageableCollection = factory(_, Backbone);\n\n    /**\n       __BROWSER ONLY__\n\n       If you already have an object named `PageableCollection` attached to the\n       `Backbone` module, you can use this to return a local reference to this\n       PageableCollection class and reset the name PageableCollection to its\n       previous definition.\n\n           // The left hand side gives you a reference to this\n           // PageableCollection implementation, the right hand side\n           // resets PageableCollection to your other PageableCollection.\n           var PageableCollection = PageableCollection.noConflict();\n\n       @static\n       @return {PageableCollection}\n    */\n    Backbone.PageableCollection.noConflict = function () {\n      Backbone.PageableCollection = oldPageableCollection;\n      return PageableCollection;\n    };\n  }\n\n}(function (_, Backbone) {\n\n  \"use strict\";\n\n  var _extend = _.extend;\n  var _omit = _.omit;\n  var _clone = _.clone;\n  var _each = _.each;\n  var _pick = _.pick;\n  var _contains = _.includes;\n  var _isEmpty = _.isEmpty;\n  var _pairs = _.pairs || _.toPairs;\n  var _invert = _.invert;\n  var _isArray = _.isArray;\n  var _isFunction = _.isFunction;\n  var _isObject = _.isObject;\n  var _keys = _.keys;\n  var _isUndefined = _.isUndefined;\n  var ceil = Math.ceil;\n  var floor = Math.floor;\n  var max = Math.max;\n\n  var BBColProto = Backbone.Collection.prototype;\n\n  function finiteInt (val, name) {\n    if (!_.isNumber(val) || _.isNaN(val) || !_.isFinite(val) || ~~val !== val) {\n      throw new TypeError(\"`\" + name + \"` must be a finite integer\");\n    }\n    return val;\n  }\n\n  function queryStringToParams (qs) {\n    var kvp, k, v, ls, params = {}, decode = decodeURIComponent;\n    var kvps = qs.split(\"&\");\n    for (var i = 0, l = kvps.length; i < l; i++) {\n      var param = kvps[i];\n      kvp = param.split(\"=\"), k = kvp[0], v = kvp[1];\n      if (v == null) v = true;\n      k = decode(k), v = decode(v), ls = params[k];\n      if (_isArray(ls)) ls.push(v);\n      else if (ls) params[k] = [ls, v];\n      else params[k] = v;\n    }\n    return params;\n  }\n\n  // hack to make sure the whatever event handlers for this event is run\n  // before func is, and the event handlers that func will trigger.\n  function runOnceAtLastHandler (col, event, func) {\n    var eventHandlers = col._events[event];\n    if (eventHandlers && eventHandlers.length) {\n      var lastHandler = eventHandlers[eventHandlers.length - 1];\n      var oldCallback = lastHandler.callback;\n      lastHandler.callback = function () {\n        try {\n          oldCallback.apply(this, arguments);\n          func();\n        }\n        catch (e) {\n          throw e;\n        }\n        finally {\n          lastHandler.callback = oldCallback;\n        }\n      };\n    }\n    else func();\n  }\n\n  var PARAM_TRIM_RE = /[\\s'\"]/g;\n  var URL_TRIM_RE = /[<>\\s'\"]/g;\n\n\n  /**\n   * State change event. Fired when PageableCollection#state gets updated\n   *\n   * @event pageable:state:change\n   * @type {object} The PageableCollection#state object of this\n   * PageableCollection instance\n   */\n\n\n  /**\n     Drop-in replacement for Backbone.Collection. Supports server-side and\n     client-side pagination and sorting. Client-side mode also support fully\n     multi-directional synchronization of changes between pages.\n\n     @class PageableCollection\n     @extends Backbone.Collection\n  */\n  var PageableCollection = Backbone.PageableCollection = Backbone.Collection.extend({\n\n    /**\n       The container object to store all pagination states.\n\n       You can override the default state by extending this class or specifying\n       them in an `options` hash to the constructor.\n\n       @property {number} firstPage = 1 - The first page index. Set to 0 if\n       your server API uses 0-based indices. You should only override this value\n       during extension, initialization or reset by the server after\n       fetching. This value should be read only at other times.\n\n       @property {number} lastPage = null - The last page index. This value\n       is __read only__ and it's calculated based on whether `firstPage` is 0 or\n       1, during bootstrapping, fetching and resetting. Please don't change this\n       value under any circumstances.\n\n       @property {number} currentPage = null - The current page index. You\n       should only override this value during extension, initialization or reset\n       by the server after fetching. This value should be read only at other\n       times. Can be a 0-based or 1-based index, depending on whether\n       `firstPage` is 0 or 1. If left as default, it will be set to `firstPage`\n       on initialization.\n\n       @property {number} pageSize = 25 - How many records to show per\n       page. This value is __read only__ after initialization, if you want to\n       change the page size after initialization, you must call\n       PageableCollection#setPageSize.\n\n       @property {number} totalPages = null - How many pages there are. This\n       value is __read only__ and it is calculated from `totalRecords`.\n\n       @property {number} totalRecords = null - How many records there\n       are. This value is __required__ under server mode. This value is optional\n       for client mode as the number will be the same as the number of models\n       during bootstrapping and during fetching, either supplied by the server\n       in the metadata, or calculated from the size of the response.\n\n       @property {string} sortKey = null - The model attribute to use for\n       sorting.\n\n       @property {number} order = -1 - The order to use for sorting. Specify\n       -1 for ascending order or 1 for descending order. If 0, no client side\n       sorting will be done and the order query parameter will not be sent to\n       the server during a fetch.\n    */\n    state: {\n      firstPage: 1,\n      lastPage: null,\n      currentPage: null,\n      pageSize: 25,\n      totalPages: null,\n      totalRecords: null,\n      sortKey: null,\n      order: -1\n    },\n\n    /**\n       @property {string} mode = \"server\" The mode of operations for this\n       collection. `\"server\"` paginates on the server-side, `\"client\"` paginates\n       on the client-side and `\"infinite\"` paginates on the server-side for APIs\n       that do not support `totalRecords`.\n    */\n    mode: \"server\",\n\n    /**\n       A translation map to convert PageableCollection state attributes\n       to the query parameters accepted by your server API.\n\n       You can override the default state by extending this class or specifying\n       them in `options.queryParams` object hash to the constructor.\n\n       @property {string|function():string} currentPage = \"page\"\n       @property {string|function():string} pageSize = \"per_page\"\n       @property {string|function():string} totalPages = \"total_pages\"\n       @property {string|function():string} totalRecords = \"total_entries\"\n       @property {string|function():string} sortKey = \"sort_by\"\n       @property {string|function():string} order = \"order\"\n       @property {Object} directions = {\"-1\": \"asc\", \"1\": \"desc\"} - A map for\n       translating a PageableCollection#state.order constant to the ones your\n       server API accepts.\n    */\n    queryParams: {\n      currentPage: \"page\",\n      pageSize: \"per_page\",\n      totalPages: \"total_pages\",\n      totalRecords: \"total_entries\",\n      sortKey: \"sort_by\",\n      order: \"order\",\n      directions: {\n        \"-1\": \"asc\",\n        \"1\": \"desc\"\n      }\n    },\n\n    /**\n       Given a list of models or model attributues, bootstraps the full\n       collection in client mode or infinite mode, or just the page you want in\n       server mode.\n\n       If you want to initialize a collection to a different state than the\n       default, you can specify them in `options.state`. Any state parameters\n       supplied will be merged with the default. If you want to change the\n       default mapping from PageableCollection#state keys to your server API's\n       query parameter names, you can specifiy an object hash in\n       `option.queryParams`. Likewise, any mapping provided will be merged with\n       the default. Lastly, all Backbone.Collection constructor options are also\n       accepted.\n\n       See:\n\n       - PageableCollection#state\n       - PageableCollection#queryParams\n       - [Backbone.Collection#initialize](http://backbonejs.org/#Collection-constructor)\n\n       @constructor\n\n       @property {Backbone.Collection} fullCollection - __CLIENT MODE ONLY__\n       This collection is the internal storage for the bootstrapped or fetched\n       models. You can use this if you want to operate on all the pages.\n\n       @param {Array.<Object>} models\n\n       @param {Object} options\n\n       @param {function(*, *): number} options.comparator - If specified, this\n       comparator is set to the current page under server mode, or the\n       PageableCollection#fullCollection otherwise.\n\n       @param {boolean} options.full 0 If `false` and either a\n       `options.comparator` or `sortKey` is defined, the comparator is attached\n       to the current page. Default is `true` under client or infinite mode and\n       the comparator will be attached to the PageableCollection#fullCollection.\n\n       @param {Object} options.state - The state attributes overriding the defaults.\n\n       @param {string} options.state.sortKey - The model attribute to use for\n       sorting. If specified instead of `options.comparator`, a comparator will\n       be automatically created using this value, and optionally a sorting order\n       specified in `options.state.order`. The comparator is then attached to\n       the new collection instance.\n\n       @param {number} options.state.order - The order to use for sorting. Specify\n       -1 for ascending order and 1 for descending order.\n\n       @param {Object} options.queryParam\n    */\n    constructor: function (models, options) {\n\n      BBColProto.constructor.apply(this, arguments);\n\n      options = options || {};\n\n      var mode = this.mode = options.mode || this.mode || PageableProto.mode;\n\n      var queryParams = _extend({}, PageableProto.queryParams, this.queryParams,\n                                options.queryParams || {});\n\n      queryParams.directions = _extend({},\n                                       PageableProto.queryParams.directions,\n                                       this.queryParams.directions,\n                                       queryParams.directions);\n\n      this.queryParams = queryParams;\n\n      var state = this.state = _extend({}, PageableProto.state, this.state,\n                                       options.state);\n\n      state.currentPage = state.currentPage == null ?\n        state.firstPage :\n        state.currentPage;\n\n      if (!_isArray(models)) models = models ? [models] : [];\n      models = models.slice();\n\n      if (mode != \"server\" && state.totalRecords == null && !_isEmpty(models)) {\n        // Can't use models.length naively here because Backbone.Collection will\n        // dedupe by `idAttribute`\n        state.totalRecords = this.length;\n      }\n\n      this.switchMode(mode, _extend({fetch: false,\n                                     resetState: false,\n                                     models: models}, options));\n\n      var comparator = options.comparator;\n\n      if (state.sortKey && !comparator) {\n        this.setSorting(state.sortKey, state.order, options);\n      }\n\n      if (mode != \"server\") {\n        var fullCollection = this.fullCollection;\n\n        if (comparator && options.full) {\n          this.comparator = null;\n          fullCollection.comparator = comparator;\n        }\n\n        if (options.full) fullCollection.sort();\n\n        // make sure the models in the current page and full collection have the\n        // same references\n        if (!_isEmpty(models)) {\n          this.getPage(state.currentPage);\n        }\n      }\n\n      this._initState = _clone(this.state);\n    },\n\n    /**\n       Makes a Backbone.Collection that contains all the pages.\n\n       @private\n       @param {Array.<Object|Backbone.Model>} models\n       @param {Object} options Options for Backbone.Collection constructor.\n       @return {Backbone.Collection}\n    */\n    _makeFullCollection: function (models, options) {\n\n      var properties = [\"url\", \"model\", \"sync\", \"comparator\"];\n      var thisProto = this.constructor.prototype;\n      var i, length, prop;\n\n      var proto = {};\n      for (i = 0, length = properties.length; i < length; i++) {\n        prop = properties[i];\n        if (!_isUndefined(thisProto[prop])) {\n          proto[prop] = thisProto[prop];\n        }\n      }\n\n      var fullCollection = new (Backbone.Collection.extend(proto))(models, options);\n\n      for (i = 0, length = properties.length; i < length; i++) {\n        prop = properties[i];\n        if (this[prop] !== thisProto[prop]) {\n          fullCollection[prop] = this[prop];\n        }\n      }\n\n      return fullCollection;\n    },\n\n    /**\n       Factory method that returns a Backbone event handler that responses to\n       the `add`, `remove`, `reset`, and the `sort` events. The returned event\n       handler will synchronize the current page collection and the full\n       collection's models.\n\n       @private\n\n       @fires PageableCollection#pageable:state:change when handling an\n       `add`, `remove`, or `reset` event\n\n       @param {PageableCollection} pageCol\n       @param {Backbone.Collection} fullCol\n\n       @return {function(string, Backbone.Model, Backbone.Collection, Object)}\n       Collection event handler\n    */\n    _makeCollectionEventHandler: function (pageCol, fullCol) {\n\n      return function collectionEventHandler (event, model, collection, options) {\n\n        var handlers = pageCol._handlers;\n        _each(_keys(handlers), function (event) {\n          var handler = handlers[event];\n          pageCol.off(event, handler);\n          fullCol.off(event, handler);\n        });\n\n        var state = _clone(pageCol.state);\n        var firstPage = state.firstPage;\n        var currentPage = firstPage === 0 ?\n          state.currentPage :\n          state.currentPage - 1;\n        var pageSize = state.pageSize;\n        var pageStart = currentPage * pageSize, pageEnd = pageStart + pageSize;\n\n        if (event == \"add\") {\n          var pageIndex, fullIndex, addAt, colToAdd, options = options || {};\n          if (collection == fullCol) {\n            fullIndex = fullCol.indexOf(model);\n            if (fullIndex >= pageStart && fullIndex < pageEnd) {\n              colToAdd = pageCol;\n              pageIndex = addAt = fullIndex - pageStart;\n            }\n          }\n          else {\n            pageIndex = pageCol.indexOf(model);\n            fullIndex = pageStart + pageIndex;\n            colToAdd = fullCol;\n            var addAt = !_isUndefined(options.at) ?\n              options.at + pageStart :\n              fullIndex;\n          }\n\n          if (!options.onRemove) {\n            ++state.totalRecords;\n            delete options.onRemove;\n          }\n\n          pageCol.state = pageCol._checkState(state);\n\n          if (colToAdd) {\n            colToAdd.add(model, _extend({}, options, {at: addAt}));\n            var modelToRemove = pageIndex >= pageSize ?\n              model :\n              !_isUndefined(options.at) && addAt < pageEnd && pageCol.length > pageSize ?\n              pageCol.at(pageSize) :\n              null;\n            if (modelToRemove) {\n              runOnceAtLastHandler(collection, event, function () {\n                pageCol.remove(modelToRemove, {onAdd: true});\n              });\n            }\n          }\n\n          if (!options.silent) pageCol.trigger(\"pageable:state:change\", pageCol.state);\n        }\n\n        // remove the model from the other collection as well\n        if (event == \"remove\") {\n          if (!options.onAdd) {\n            // decrement totalRecords and update totalPages and lastPage\n            if (!--state.totalRecords) {\n              state.totalRecords = null;\n              state.totalPages = null;\n            }\n            else {\n              var totalPages = state.totalPages = ceil(state.totalRecords / pageSize);\n              state.lastPage = firstPage === 0 ? totalPages - 1 : totalPages || firstPage;\n              if (state.currentPage > totalPages) state.currentPage = state.lastPage;\n            }\n            pageCol.state = pageCol._checkState(state);\n\n            var nextModel, removedIndex = options.index;\n            if (collection == pageCol) {\n              if (nextModel = fullCol.at(pageEnd)) {\n                runOnceAtLastHandler(pageCol, event, function () {\n                  pageCol.push(nextModel, {onRemove: true});\n                });\n              }\n              else if (!pageCol.length && state.totalRecords) {\n                pageCol.reset(fullCol.models.slice(pageStart - pageSize, pageEnd - pageSize),\n                              _extend({}, options, {parse: false}));\n              }\n              fullCol.remove(model);\n            }\n            else if (removedIndex >= pageStart && removedIndex < pageEnd) {\n              if (nextModel = fullCol.at(pageEnd - 1)) {\n                runOnceAtLastHandler(pageCol, event, function () {\n                  pageCol.push(nextModel, {onRemove: true});\n                });\n              }\n              pageCol.remove(model);\n              if (!pageCol.length && state.totalRecords) {\n                pageCol.reset(fullCol.models.slice(pageStart - pageSize, pageEnd - pageSize),\n                              _extend({}, options, {parse: false}));\n              }\n            }\n          }\n          else delete options.onAdd;\n\n          if (!options.silent) pageCol.trigger(\"pageable:state:change\", pageCol.state);\n        }\n\n        if (event == \"reset\") {\n          options = collection;\n          collection = model;\n\n          // Reset that's not a result of getPage\n          if (collection == pageCol && options.from == null &&\n              options.to == null) {\n            var head = fullCol.models.slice(0, pageStart);\n            var tail = fullCol.models.slice(pageStart + pageCol.models.length);\n            fullCol.reset(head.concat(pageCol.models).concat(tail), options);\n          }\n          else if (collection == fullCol) {\n            if (!(state.totalRecords = fullCol.models.length)) {\n              state.totalRecords = null;\n              state.totalPages = null;\n            }\n            if (pageCol.mode == \"client\") {\n              firstPage = state.lastPage = state.currentPage = state.firstPage;\n              currentPage = firstPage === 0 ? state.currentPage : state.currentPage - 1;\n              pageStart = currentPage * pageSize;\n              pageEnd = pageStart + pageSize;\n            }\n            pageCol.state = pageCol._checkState(state);\n            pageCol.reset(fullCol.models.slice(pageStart, pageEnd),\n                          _extend({}, options, {parse: false}));\n          }\n\n          if (!options.silent) pageCol.trigger(\"pageable:state:change\", pageCol.state);\n        }\n\n        if (event == \"sort\") {\n          options = collection;\n          collection = model;\n          if (collection === fullCol) {\n            pageCol.reset(fullCol.models.slice(pageStart, pageEnd),\n                          _extend({}, options, {parse: false}));\n          }\n        }\n\n        _each(_keys(handlers), function (event) {\n          var handler = handlers[event];\n          _each([pageCol, fullCol], function (col) {\n            col.on(event, handler);\n            var callbacks = col._events[event] || [];\n            callbacks.unshift(callbacks.pop());\n          });\n        });\n      };\n    },\n\n    /**\n       Sanity check this collection's pagination states. Only perform checks\n       when all the required pagination state values are defined and not null.\n       If `totalPages` is undefined or null, it is set to `totalRecords` /\n       `pageSize`. `lastPage` is set according to whether `firstPage` is 0 or 1\n       when no error occurs.\n\n       @private\n\n       @param {Object} state\n\n       @throws {TypeError} If `totalRecords`, `pageSize`, `currentPage` or\n       `firstPage` is not a finite integer.\n\n       @throws {RangeError} If `pageSize`, `currentPage` or `firstPage` is out\n       of bounds.\n\n       @return {Object} Returns the `state` object if no error was found.\n    */\n    _checkState: function (state) {\n      var mode = this.mode;\n      var links = this.links;\n      var totalRecords = state.totalRecords;\n      var pageSize = state.pageSize;\n      var currentPage = state.currentPage;\n      var firstPage = state.firstPage;\n      var totalPages = state.totalPages;\n\n      if (totalRecords != null && pageSize != null && currentPage != null &&\n          firstPage != null && (mode == \"infinite\" ? links : true)) {\n\n        totalRecords = finiteInt(totalRecords, \"totalRecords\");\n        pageSize = finiteInt(pageSize, \"pageSize\");\n        currentPage = finiteInt(currentPage, \"currentPage\");\n        firstPage = finiteInt(firstPage, \"firstPage\");\n\n        if (pageSize < 1) {\n          throw new RangeError(\"`pageSize` must be >= 1\");\n        }\n\n        totalPages = state.totalPages = ceil(totalRecords / pageSize);\n\n        if (firstPage < 0 || firstPage > 1) {\n          throw new RangeError(\"`firstPage must be 0 or 1`\");\n        }\n\n        state.lastPage = firstPage === 0 ? max(0, totalPages - 1) : totalPages || firstPage;\n\n        if (mode == \"infinite\") {\n          if (!links[currentPage]) {\n            throw new RangeError(\"No link found for page \" + currentPage);\n          }\n        }\n        else if (currentPage < firstPage ||\n                 (totalPages > 0 &&\n                  (firstPage ? currentPage > totalPages : currentPage >= totalPages))) {\n          throw new RangeError(\"`currentPage` must be firstPage <= currentPage \" +\n                               (firstPage ? \"<\" : \"<=\") +\n                               \" totalPages if \" + firstPage + \"-based. Got \" +\n                               currentPage + \".\");\n        }\n      }\n\n      return state;\n    },\n\n    /**\n       Change the page size of this collection.\n\n       Under most if not all circumstances, you should call this method to\n       change the page size of a pageable collection because it will keep the\n       pagination state sane. By default, the method will recalculate the\n       current page number to one that will retain the current page's models\n       when increasing the page size. When decreasing the page size, this method\n       will retain the last models to the current page that will fit into the\n       smaller page size.\n\n       If `options.first` is true, changing the page size will also reset the\n       current page back to the first page instead of trying to be smart.\n\n       For server mode operations, changing the page size will trigger a\n       PageableCollection#fetch and subsequently a `reset` event.\n\n       For client mode operations, changing the page size will `reset` the\n       current page by recalculating the current page boundary on the client\n       side.\n\n       If `options.fetch` is true, a fetch can be forced if the collection is in\n       client mode.\n\n       @param {number} pageSize - The new page size to set to PageableCollection#state.\n       @param {Object} options - {@link PageableCollection#fetch} options.\n       @param {boolean} options.first = false 0 Reset the current page number to\n       the first page if `true`.\n       @param {boolean} options.fetch - If `true`, force a fetch in client mode.\n\n       @throws {TypeError} If `pageSize` is not a finite integer.\n       @throws {RangeError} If `pageSize` is less than 1.\n\n       @chainable\n       @return {XMLHttpRequest|PageableCollection} The XMLHttpRequest\n       from fetch or this.\n    */\n    setPageSize: function (pageSize, options) {\n      pageSize = finiteInt(pageSize, \"pageSize\");\n\n      options = options || {first: false};\n\n      var state = this.state;\n      var totalPages = ceil(state.totalRecords / pageSize);\n      var currentPage = totalPages ?\n          max(state.firstPage, floor(totalPages * state.currentPage / state.totalPages)) :\n        state.firstPage;\n\n      state = this.state = this._checkState(_extend({}, state, {\n        pageSize: pageSize,\n        currentPage: options.first ? state.firstPage : currentPage,\n        totalPages: totalPages\n      }));\n\n      return this.getPage(state.currentPage, _omit(options, [\"first\"]));\n    },\n\n    /**\n       Switching between client, server and infinite mode.\n\n       If switching from client to server mode, the #fullCollection is emptied\n       first and then deleted and a fetch is immediately issued for the current\n       page from the server. Pass `false` to `options.fetch` to skip fetching.\n\n       If switching to infinite mode, and if `options.models` is given for an\n       array of models,PageableCollection#links will be populated with a URL per\n       page, using the default URL for this collection.\n\n       If switching from server to client mode, all of the pages are immediately\n       refetched. If you have too many pages, you can pass `false` to\n       `options.fetch` to skip fetching.\n\n       If switching to any mode from infinite mode, thePageableCollection#links\n       will be deleted.\n\n       @fires PageableCollection#pageable:state:change\n\n       @param {\"server\"|\"client\"|\"infinite\"} mode - The mode to switch to.\n\n       @param {Object} options\n\n       @param {boolean} options.fetch = true - If `false`, no fetching is done.\n\n       @param {boolean} options.resetState = true - If 'false', the state is not\n       reset, but checked for sanity instead.\n\n       @chainable\n       @return {XMLHttpRequest|PageableCollection} The XMLHttpRequest\n       from fetch or this if `options.fetch` is `false`.\n    */\n    switchMode: function (mode, options) {\n\n      if (!_contains([\"server\", \"client\", \"infinite\"], mode)) {\n        throw new TypeError('`mode` must be one of \"server\", \"client\" or \"infinite\"');\n      }\n\n      options = options || {fetch: true, resetState: true};\n\n      var state = this.state = options.resetState ?\n        _clone(this._initState) :\n        this._checkState(_extend({}, this.state));\n\n      this.mode = mode;\n\n      var self = this;\n      var fullCollection = this.fullCollection;\n      var handlers = this._handlers = this._handlers || {}, handler;\n      if (mode != \"server\" && !fullCollection) {\n        fullCollection = this._makeFullCollection(options.models || [], options);\n        fullCollection.pageableCollection = this;\n        this.fullCollection = fullCollection;\n        var allHandler = this._makeCollectionEventHandler(this, fullCollection);\n        _each([\"add\", \"remove\", \"reset\", \"sort\"], function (event) {\n          handlers[event] = handler = _.bind(allHandler, {}, event);\n          self.on(event, handler);\n          fullCollection.on(event, handler);\n        });\n        fullCollection.comparator = this._fullComparator;\n      }\n      else if (mode == \"server\" && fullCollection) {\n        _each(_keys(handlers), function (event) {\n          handler = handlers[event];\n          self.off(event, handler);\n          fullCollection.off(event, handler);\n        });\n        delete this._handlers;\n        this._fullComparator = fullCollection.comparator;\n        delete this.fullCollection;\n      }\n\n      if (mode == \"infinite\") {\n        var links = this.links = {};\n        var firstPage = state.firstPage;\n        var totalPages = ceil(state.totalRecords / state.pageSize);\n        var lastPage = firstPage === 0 ? max(0, totalPages - 1) : totalPages || firstPage;\n        for (var i = state.firstPage; i <= lastPage; i++) {\n          links[i] = this.url;\n        }\n      }\n      else if (this.links) delete this.links;\n\n      if (!options.silent) this.trigger(\"pageable:state:change\", state);\n\n      return options.fetch ?\n        this.fetch(_omit(options, \"fetch\", \"resetState\")) :\n        this;\n    },\n\n    /**\n       @return {boolean} `true` if this collection can page backward, `false`\n       otherwise.\n    */\n    hasPreviousPage: function () {\n      var state = this.state;\n      var currentPage = state.currentPage;\n      if (this.mode != \"infinite\") return currentPage > state.firstPage;\n      return !!this.links[currentPage - 1];\n    },\n\n    /**\n       @return {boolean} `true` if this collection can page forward, `false`\n       otherwise.\n    */\n    hasNextPage: function () {\n      var state = this.state;\n      var currentPage = this.state.currentPage;\n      if (this.mode != \"infinite\") return currentPage < state.lastPage;\n      return !!this.links[currentPage + 1];\n    },\n\n    /**\n       Fetch the first page in server mode, or reset the current page of this\n       collection to the first page in client or infinite mode.\n\n       @param {Object} options {@linkPageableCollection#getPage} options.\n\n       @chainable\n       @return {XMLHttpRequest|PageableCollection} The XMLHttpRequest\n       from fetch or this.\n    */\n    getFirstPage: function (options) {\n      return this.getPage(\"first\", options);\n    },\n\n    /**\n       Fetch the previous page in server mode, or reset the current page of this\n       collection to the previous page in client or infinite mode.\n\n       @param {Object} options {@linkPageableCollection#getPage} options.\n\n       @chainable\n       @return {XMLHttpRequest|PageableCollection} The XMLHttpRequest\n       from fetch or this.\n    */\n    getPreviousPage: function (options) {\n      return this.getPage(\"prev\", options);\n    },\n\n    /**\n       Fetch the next page in server mode, or reset the current page of this\n       collection to the next page in client mode.\n\n       @param {Object} options {@linkPageableCollection#getPage} options.\n\n       @chainable\n       @return {XMLHttpRequest|PageableCollection} The XMLHttpRequest\n       from fetch or this.\n    */\n    getNextPage: function (options) {\n      return this.getPage(\"next\", options);\n    },\n\n    /**\n       Fetch the last page in server mode, or reset the current page of this\n       collection to the last page in client mode.\n\n       @param {Object} options {@linkPageableCollection#getPage} options.\n\n       @chainable\n       @return {XMLHttpRequest|PageableCollection} The XMLHttpRequest\n       from fetch or this.\n    */\n    getLastPage: function (options) {\n      return this.getPage(\"last\", options);\n    },\n\n    /**\n       Given a page index, set PageableCollection#state.currentPage to that\n       index. If this collection is in server mode, fetch the page using the\n       updated state, otherwise, reset the current page of this collection to\n       the page specified by `index` in client mode. If `options.fetch` is true,\n       a fetch can be forced in client mode before resetting the current\n       page. Under infinite mode, if the index is less than the current page, a\n       reset is done as in client mode. If the index is greater than the current\n       page number, a fetch is made with the results **appended**\n       toPageableCollection#fullCollection.  The current page will then be reset\n       after fetching.\n\n       @fires PageableCollection#pageable:state:change\n\n       @param {number|string} index - The page index to go to, or the page name to\n       look up fromPageableCollection#links in infinite mode.\n       @param {Object} options - {@linkPageableCollection#fetch} options or\n       [reset](http://backbonejs.org/#Collection-reset) options for client mode\n       when `options.fetch` is `false`.\n       @param {boolean} options.fetch = false - If true, force a\n       {@linkPageableCollection#fetch} in client mode.\n\n       @throws {TypeError} If `index` is not a finite integer under server or\n       client mode, or does not yield a URL fromPageableCollection#links under\n       infinite mode.\n\n       @throws {RangeError} If `index` is out of bounds.\n\n       @chainable\n       @return {XMLHttpRequest|PageableCollection} The XMLHttpRequest\n       from fetch or this.\n    */\n    getPage: function (index, options) {\n\n      var mode = this.mode, fullCollection = this.fullCollection;\n\n      options = options || {fetch: false};\n\n      var state = this.state,\n      firstPage = state.firstPage,\n      currentPage = state.currentPage,\n      lastPage = state.lastPage,\n      pageSize = state.pageSize;\n\n      var pageNum = index;\n      switch (index) {\n        case \"first\": pageNum = firstPage; break;\n        case \"prev\": pageNum = currentPage - 1; break;\n        case \"next\": pageNum = currentPage + 1; break;\n        case \"last\": pageNum = lastPage; break;\n        default: pageNum = finiteInt(index, \"index\");\n      }\n\n      this.state = this._checkState(_extend({}, state, {currentPage: pageNum}));\n      if (!options.silent) this.trigger(\"pageable:state:change\", this.state);\n\n      options.from = currentPage, options.to = pageNum;\n\n      var pageStart = (firstPage === 0 ? pageNum : pageNum - 1) * pageSize;\n      var pageModels = fullCollection && fullCollection.length ?\n        fullCollection.models.slice(pageStart, pageStart + pageSize) :\n        [];\n      if ((mode == \"client\" || (mode == \"infinite\" && !_isEmpty(pageModels))) &&\n          !options.fetch) {\n        this.reset(pageModels, _omit(options, \"fetch\"));\n        return this;\n      }\n\n      if (mode == \"infinite\") options.url = this.links[pageNum];\n\n      return this.fetch(_omit(options, \"fetch\"));\n    },\n\n    /**\n       Fetch the page for the provided item offset in server mode, or reset the\n       current page of this collection to the page for the provided item offset\n       in client mode.\n\n       @param {number} offset\n       @param {Object} options {@linkPageableCollection#getPage} options.\n\n       @chainable\n       @return {XMLHttpRequest|PageableCollection} The XMLHttpRequest\n       from fetch or this.\n    */\n    getPageByOffset: function (offset, options) {\n      if (offset < 0) {\n        throw new RangeError(\"`offset must be > 0`\");\n      }\n      offset = finiteInt(offset, \"offset\");\n\n      var page = floor(offset / this.state.pageSize);\n      if (this.state.firstPage !== 0) page++;\n      if (page > this.state.lastPage) page = this.state.lastPage;\n      return this.getPage(page, options);\n    },\n\n    /**\n       Overidden to make `getPage` compatible with Zepto.\n\n       @param {string} method\n       @param {Backbone.Model|Backbone.Collection} model\n       @param {Object} options\n\n       @return {XMLHttpRequest}\n    */\n    sync: function (method, model, options) {\n      var self = this;\n      if (self.mode == \"infinite\") {\n        var success = options.success;\n        var currentPage = self.state.currentPage;\n        options.success = function (resp, status, xhr) {\n          var links = self.links;\n          var newLinks = self.parseLinks(resp, _extend({xhr: xhr}, options));\n          if (newLinks.first) links[self.state.firstPage] = newLinks.first;\n          if (newLinks.prev) links[currentPage - 1] = newLinks.prev;\n          if (newLinks.next) links[currentPage + 1] = newLinks.next;\n          if (success) success(resp, status, xhr);\n        };\n      }\n\n      return (BBColProto.sync || Backbone.sync).call(self, method, model, options);\n    },\n\n    /**\n       Parse pagination links from the server response. Only valid under\n       infinite mode.\n\n       Given a response body and a XMLHttpRequest object, extract pagination\n       links from them for infinite paging.\n\n       This default implementation parses the RFC 5988 `Link` header and extract\n       3 links from it - `first`, `prev`, `next`. Any subclasses overriding this\n       method __must__ return an object hash having only the keys\n       above. However, simply returning a `next` link or an empty hash if there\n       are no more links should be enough for most implementations.\n\n       @param {*} resp The deserialized response body.\n       @param {Object} options\n       @param {XMLHttpRequest} options.xhr - The XMLHttpRequest object for this\n       response.\n       @return {Object}\n    */\n    parseLinks: function (resp, options) {\n      var links = {};\n      var linkHeader = options.xhr.getResponseHeader(\"Link\");\n      if (linkHeader) {\n        var relations = [\"first\", \"prev\", \"next\"];\n        _each(linkHeader.split(\",\"), function (linkValue) {\n          var linkParts = linkValue.split(\";\");\n          var url = linkParts[0].replace(URL_TRIM_RE, \"\");\n          var params = linkParts.slice(1);\n          _each(params, function (param) {\n            var paramParts = param.split(\"=\");\n            var key = paramParts[0].replace(PARAM_TRIM_RE, \"\");\n            var value = paramParts[1].replace(PARAM_TRIM_RE, \"\");\n            if (key == \"rel\" && _contains(relations, value)) links[value] = url;\n          });\n        });\n      }\n\n      return links;\n    },\n\n    /**\n       Parse server response data.\n\n       This default implementation assumes the response data is in one of two\n       structures:\n\n           [\n             {}, // Your new pagination state\n             [{}, ...] // An array of JSON objects\n           ]\n\n       Or,\n\n           [{}] // An array of JSON objects\n\n       The first structure is the preferred form because the pagination states\n       may have been updated on the server side, sending them down again allows\n       this collection to update its states. If the response has a pagination\n       state object, it is checked for errors.\n\n       The second structure is the\n       [Backbone.Collection#parse](http://backbonejs.org/#Collection-parse)\n       default.\n\n       **Note:** this method has been further simplified since 1.1.7. While\n       existingPageableCollection#parse implementations will continue to work,\n       new code is encouraged to overridePageableCollection#parseState\n       andPageableCollection#parseRecords instead.\n\n       @fires PageableCollection#pageable:state:change\n\n       @param {Object} resp The deserialized response data from the server.\n       @param {Object} options The options for the ajax request\n\n       @return {Array.<Object>} An array of model objects\n    */\n    parse: function (resp, options) {\n      var newState = this.parseState(resp, _clone(this.queryParams), _clone(this.state), options);\n      if (newState) {\n        this.state = this._checkState(_extend({}, this.state, newState));\n        if (!(options || {}).silent) this.trigger(\"pageable:state:change\", this.state);\n      }\n      return this.parseRecords(resp, options);\n    },\n\n    /**\n       Parse server response for server pagination state updates. Not applicable\n       under infinite mode.\n\n       This default implementation first checks whether the response has any\n       state object as documented inPageableCollection#parse. If it exists, a\n       state object is returned by mapping the server state keys to this\n       pageable collection instance's query parameter keys using `queryParams`.\n\n       It is __NOT__ neccessary to return a full state object complete with all\n       the mappings defined inPageableCollection#queryParams. Any state object\n       resulted is merged with a copy of the current pageable collection state\n       and checked for sanity before actually updating. Most of the time, simply\n       providing a new `totalRecords` value is enough to trigger a full\n       pagination state recalculation.\n\n           parseState: function (resp, queryParams, state, options) {\n             return {totalRecords: resp.total_entries};\n           }\n\n       If you want to use header fields use:\n\n           parseState: function (resp, queryParams, state, options) {\n               return {totalRecords: options.xhr.getResponseHeader(\"X-total\")};\n           }\n\n       This method __MUST__ return a new state object instead of directly\n       modifying the PageableCollection#state object. The behavior of directly\n       modifying PageableCollection#state is undefined.\n\n       @param {Object} resp - The deserialized response data from the server.\n       @param {Object} queryParams - A copy of PageableCollection#queryParams.\n       @param {Object} state - A copy of PageableCollection#state.\n       @param {Object} options - The options passed through from\n       `parse`. (backbone >= 0.9.10 only)\n\n       @return {Object} A new (partial) state object.\n     */\n    parseState: function (resp, queryParams, state, options) {\n      if (resp && resp.length === 2 && _isObject(resp[0]) && _isArray(resp[1])) {\n\n        var newState = _clone(state);\n        var serverState = resp[0];\n\n        _each(_pairs(_omit(queryParams, \"directions\")), function (kvp) {\n          var k = kvp[0], v = kvp[1];\n          var serverVal = serverState[v];\n          if (!_isUndefined(serverVal) && !_.isNull(serverVal)) newState[k] = serverState[v];\n        });\n\n        if (serverState.order) {\n          newState.order = _invert(queryParams.directions)[serverState.order] * 1;\n        }\n\n        return newState;\n      }\n    },\n\n    /**\n       Parse server response for an array of model objects.\n\n       This default implementation first checks whether the response has any\n       state object as documented inPageableCollection#parse. If it exists, the\n       array of model objects is assumed to be the second element, otherwise the\n       entire response is returned directly.\n\n       @param {Object} resp - The deserialized response data from the server.\n       @param {Object} options - The options passed through from the\n       `parse`. (backbone >= 0.9.10 only)\n\n       @return {Array.<Object>} An array of model objects\n     */\n    parseRecords: function (resp, options) {\n      if (resp && resp.length === 2 && _isObject(resp[0]) && _isArray(resp[1])) {\n        return resp[1];\n      }\n\n      return resp;\n    },\n\n    /**\n       Fetch a page from the server in server mode, or all the pages in client\n       mode. Under infinite mode, the current page is refetched by default and\n       then reset.\n\n       The query string is constructed by translating the current pagination\n       state to your server API query parameter\n       usingPageableCollection#queryParams. The current page will reset after\n       fetch.\n\n       @param {Object} options - Accepts all\n       [Backbone.Collection#fetch](http://backbonejs.org/#Collection-fetch)\n       options.\n\n       @return {XMLHttpRequest}\n    */\n    fetch: function (options) {\n\n      options = options || {};\n\n      var state = this._checkState(this.state);\n\n      var mode = this.mode;\n\n      if (mode == \"infinite\" && !options.url) {\n        options.url = this.links[state.currentPage];\n      }\n\n      var data = options.data || {};\n\n      // dedup query params\n      var url = options.url || this.url || \"\";\n      if (_isFunction(url)) url = url.call(this);\n      var qsi = url.indexOf(\"?\");\n      if (qsi != -1) {\n        _extend(data, queryStringToParams(url.slice(qsi + 1)));\n        url = url.slice(0, qsi);\n      }\n\n      options.url = url;\n      options.data = data;\n\n      // pick the appropriate query param keys to map according to the mode\n      var queryParams = this.mode == \"client\" ?\n          _pick(this.queryParams, \"sortKey\") :\n          _omit(_pick(this.queryParams, _keys(PageableProto.queryParams)),\n                \"order\", \"directions\", \"totalPages\", \"totalRecords\");\n\n      // map the query params to the data object used by the underlying ajax lib\n      // to construct the query string\n      _each(queryParams, function (v, k) {\n        v = _isFunction(v) ? v.call(this) : v;\n        if (state[k] != null && v != null && _.isUndefined(data[v])) {\n          data[v] = state[k];\n        }\n      }, this);\n\n      var sortKey = _isFunction(this.queryParams.sortKey) ?\n          this.queryParams.sortKey.call(this) :\n          this.queryParams.sortKey;\n\n      var order = _isFunction(this.queryParams.order) ?\n          this.queryParams.order.call(this) :\n          this.queryParams.order;\n\n      if (sortKey != null && state.sortKey != null &&\n          order != null && state.order != null) {\n        if (_isArray(state.order)) {\n          data[order] = [];\n          for (var i = 0; i < state.order.length; i++) {\n            data[order].push(this.queryParams.directions[state.order[i]]);\n          }\n        }\n        else {\n          data[order] = this.queryParams.directions[state.order + \"\"];\n        }\n      }\n\n      // map extra query parameters\n      var extraKvps = _pairs(_omit(this.queryParams,\n                                   _keys(PageableProto.queryParams)));\n      for (var i = 0; i < extraKvps.length; i++) {\n        var kvp = extraKvps[i];\n        var v = kvp[1];\n        v = _isFunction(v) ? v.call(this) : v;\n        if (v != null) data[kvp[0]] = v;\n      }\n\n      if (mode != \"server\") {\n        var self = this, fullCol = this.fullCollection;\n        var success = options.success;\n        options.success = function (col, resp, opts) {\n\n          // make sure the caller's intent is obeyed\n          opts = opts || {};\n          if (_isUndefined(options.silent)) delete opts.silent;\n          else opts.silent = options.silent;\n\n          var models = col.models;\n          if (mode == \"client\") fullCol.reset(models, opts);\n          else {\n            fullCol.add(models, _extend({at: fullCol.length},\n                                        _extend(opts, {parse: false})));\n            self.trigger(\"reset\", self, opts);\n          }\n\n          if (success) success(col, resp, opts);\n        };\n\n        // silent the first reset from backbone\n        return BBColProto.fetch.call(this, _extend({}, options, {silent: true}));\n      }\n\n      return BBColProto.fetch.call(this, options);\n    },\n\n    /**\n       Convenient method for making a `comparator` sorted by a model attribute\n       identified by `sortKey` and ordered by `order`.\n\n       Like a Backbone.Collection, a PageableCollection will maintain the\n       __current page__ in sorted order on the client side if a `comparator` is\n       attached to it. If the collection is in client mode, you can attach a\n       comparator toPageableCollection#fullCollection to have all the pages\n       reflect the global sorting order by specifying an option `full` to\n       `true`. You __must__ call `sort` manually\n       orPageableCollection#fullCollection.sort after calling this method to\n       force a resort.\n\n       While you can use this method to sort the current page in server mode,\n       the sorting order may not reflect the global sorting order due to the\n       additions or removals of the records on the server since the last\n       fetch. If you want the most updated page in a global sorting order, it is\n       recommended that you set PageableCollection#state.sortKey and optionally\n       PageableCollection#state.order, and then callPageableCollection#fetch.\n\n       @protected\n\n       @param {string} sortKey = this.state.sortKey - See `state.sortKey`.\n       @param {number} order = this.state.order - See `state.order`.\n       @param {(function(Backbone.Model, string): Object) | string} sortValue -\n       See PageableCollection#setSorting.\n\n       @return {function(Backbone.Model, string): number}\n\n       See [Backbone.Collection.comparator](http://backbonejs.org/#Collection-comparator).\n    */\n    _makeComparator: function (sortKey, order, sortValue) {\n      var state = this.state;\n\n      sortKey = sortKey || state.sortKey;\n      order = order || state.order;\n\n      if (!sortKey || !order) return;\n\n      if (!sortValue) {\n        sortValue = function (model, attr) {\n          return model.get(attr);\n        };\n      }\n\n      return function (left, right) {\n        var l = sortValue(left, sortKey), r = sortValue(right, sortKey), t;\n        if (order === 1) t = l, l = r, r = t;\n        if (l === r) return 0;\n        else if (l < r) return -1;\n        return 1;\n      };\n    },\n\n    /**\n       Adjusts the sorting for this pageable collection.\n\n       Given a `sortKey` and an `order`, sets `state.sortKey` and\n       `state.order`. A comparator can be applied on the client side to sort in\n       the order defined if `options.side` is `\"client\"`. By default the\n       comparator is applied to thePageableCollection#fullCollection. Set\n       `options.full` to `false` to apply a comparator to the current page under\n       any mode. Setting `sortKey` to `null` removes the comparator from both\n       the current page and the full collection.\n\n       If a `sortValue` function is given, it will be passed the `(model,\n       sortKey)` arguments and is used to extract a value from the model during\n       comparison sorts. If `sortValue` is not given, `model.get(sortKey)` is\n       used for sorting.\n\n       @chainable\n\n       @param {string} sortKey - See `state.sortKey`.\n       @param {number} order=this.state.order - See `state.order`.\n       @param {Object} options\n       @param {string} options.side - By default, `\"client\"` if `mode` is\n       `\"client\"`, `\"server\"` otherwise.\n       @param {boolean} options.full = true\n       @param {(function(Backbone.Model, string): Object) | string} options.sortValue\n\n       @return {PageableCollection} this\n    */\n    setSorting: function (sortKey, order, options) {\n\n      var state = this.state;\n\n      state.sortKey = sortKey;\n      state.order = order = order || state.order;\n\n      var fullCollection = this.fullCollection;\n\n      var delComp = false, delFullComp = false;\n\n      if (!sortKey) delComp = delFullComp = true;\n\n      var mode = this.mode;\n      options = _extend({side: mode == \"client\" ? mode : \"server\", full: true},\n                        options);\n\n      var comparator = this._makeComparator(sortKey, order, options.sortValue);\n\n      var full = options.full, side = options.side;\n\n      if (side == \"client\") {\n        if (full) {\n          if (fullCollection) fullCollection.comparator = comparator;\n          delComp = true;\n        }\n        else {\n          this.comparator = comparator;\n          delFullComp = true;\n        }\n      }\n      else if (side == \"server\" && !full) {\n        this.comparator = comparator;\n      }\n\n      if (delComp) this.comparator = null;\n      if (delFullComp && fullCollection) fullCollection.comparator = null;\n\n      return this;\n    }\n\n  });\n\n  var PageableProto = PageableCollection.prototype;\n\n  return PageableCollection;\n\n}));\n"],"names":["module","exports","_","Backbone","_extend","extend","_omit","omit","_clone","clone","_each","each","_pick","pick","_contains","includes","_isEmpty","isEmpty","_pairs","pairs","toPairs","_invert","invert","_isArray","isArray","_isFunction","isFunction","_isObject","isObject","_keys","keys","_isUndefined","isUndefined","ceil","Math","floor","max","BBColProto","Collection","prototype","finiteInt","val","name","isNumber","isNaN","isFinite","TypeError","queryStringToParams","qs","kvp","k","v","ls","params","decode","decodeURIComponent","kvps","split","i","l","length","push","runOnceAtLastHandler","col","event","func","eventHandlers","_events","lastHandler","oldCallback","callback","apply","this","arguments","e","PARAM_TRIM_RE","URL_TRIM_RE","PageableCollection","state","firstPage","lastPage","currentPage","pageSize","totalPages","totalRecords","sortKey","order","mode","queryParams","directions","constructor","models","options","PageableProto","slice","switchMode","fetch","resetState","comparator","setSorting","fullCollection","full","sort","getPage","_initState","_makeFullCollection","prop","properties","thisProto","proto","_makeCollectionEventHandler","pageCol","fullCol","model","collection","handlers","_handlers","handler","off","pageStart","pageEnd","pageIndex","fullIndex","colToAdd","indexOf","addAt","at","onRemove","_checkState","add","modelToRemove","remove","onAdd","silent","trigger","nextModel","removedIndex","index","reset","parse","from","to","head","tail","concat","on","callbacks","unshift","pop","links","RangeError","setPageSize","first","self","_fullComparator","pageableCollection","allHandler","bind","url","hasPreviousPage","hasNextPage","getFirstPage","getPreviousPage","getNextPage","getLastPage","pageNum","pageModels","getPageByOffset","offset","page","sync","method","success","resp","status","xhr","newLinks","parseLinks","prev","next","call","linkHeader","getResponseHeader","relations","linkValue","linkParts","replace","param","paramParts","key","value","newState","parseState","parseRecords","serverState","serverVal","isNull","data","qsi","extraKvps","opts","_makeComparator","sortValue","attr","get","left","right","t","r","delComp","delFullComp","side","factory"],"sourceRoot":""}